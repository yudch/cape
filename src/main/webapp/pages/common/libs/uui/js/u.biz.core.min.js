!function(a){"function"==typeof define&&define.amd?define(["jquery","knockout"],a):a($,ko)}(function($,ko){+function(a){"use strict";function b(a){return a.toString().length>1?a.toString():"0"+a.toString()}String.prototype.trim=function(){return this.replace(/^\s*(\b.*\b|)\s*$/,"$1")},String.prototype.replaceStr=function(a,b){var c=this.split(a);return new String(c.join(b))},String.prototype.lengthb=function(){var a=this.replace(/[^\x00-\xff]/g,"**");return a.length},String.prototype.replaceAll=function(a,b){var c=new RegExp(a,"g");return this.replace(c,b)},String.prototype.substrCH=function(a){for(var b=0,c=0;a>b&&c<this.length;){var d=this.charCodeAt(c);if(d>256&&b==a-1)break;b+=d>256?2:1,c+=1}return this.substr(0,c)},String.prototype.startWith=function(a){return 0==this.indexOf(a)},String.prototype.endWith=function(a){var b=this.indexOf(a);return-1==b?void 0:b==this.length-a.length},String.prototype.format=function(a){if(null!=a){var b=this;for(var c in a){var d=new RegExp("\\<\\#\\="+c+"\\#\\>","gi");b=b.replace(d,a[c]?"null"==a[c]?"":a[c]:"")}}return b},Date.prototype.format=function(a){var c=this.getFullYear(),d=this.getMonth()+1,e=this.getDate(),f=this.getHours(),g=this.getMinutes(),h=this.getSeconds();return a=a||"yyyy-MM-dd hh:mm:ss",a.replace(/yyyy/,c).replace(/yy/,c.toString().substr(2,2)).replace(/MM/,b(d)).replace(/M/,d).replace(/dd/,b(e)).replace(/d/,e).replace(/hh/,b(f)).replace(/h/,f).replace(/mm/,b(g)).replace(/m/,g).replace(/ss/,b(h)).replace(/s/,h)},Date.prototype.getAAAAMMJJ=function(){var a=this.getDate();10>a&&(a="0"+a);var b=this.getMonth()+1;10>b&&(b="0"+b);var c=this.getYear();return c+""+b+a},Date.prototype.getFomatDate=function(){var a=this.getFullYear(),b=this.getMonth()+1;10>b&&(b="0"+b);var c=this.getDate();return 10>c&&(c="0"+c),a+"-"+b+"-"+c},Date.prototype.getFomatDateTime=function(){var a=this.getFullYear(),b=this.getMonth()+1;10>b&&(b="0"+b);var c=this.getDate();10>c&&(c="0"+c);var d=this.getHours();10>d&&(d="0"+d);var e=this.getMinutes();10>e&&(e="0"+e);var f=this.getSeconds();return 10>f&&(f="0"+f),a+"-"+b+"-"+c+" "+d+":"+e+":"+f},Array.prototype.indexOf=function(a){for(var b=0;b<this.length;b++)if(this[b]==a)return b;return-1},Array.prototype.remove=function(a){return 0>a||a>this.length?void alert("index out of bound"):void this.splice(a,1)},Array.prototype.removeEle=function(a){for(var b=0,c=this.length;c>b;b++)if(this[b]==a)return void this.splice(b,1)},Math.UUID=function(){return((new Date).getTime()+"").substr(9)},String.UUID=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(a){var b=16*Math.random()|0,c="x"==a?b:3&b|8;return c.toString(16)})},Array.prototype.insert=function(a,b){return 0>a||a>this.length?void alert("index out of bound"):void this.splice(a,0,b)},Array.prototype.values=function(a){if(null==a)return null;for(var b=new Array,c=0;c<a.length;c++)b.push(this[a[c]]);return b},Array.prototype.clear=function(){this.splice(0,this.length)},window.getRequest=function(a){a||(a=document.location.search);var b=new Object;if(-1!=a.indexOf("?"))for(var c=a.substring(a.indexOf("?")+1),d=c.split("&"),e=0;e<d.length;e++)b[d[e].split("=")[0]]=unescape(d[e].split("=")[1]);return b},window.setCookie=function(a,b,c,d,e,f){var g=a+"="+encodeURIComponent(b);c&&(g+="; expires="+c.toGMTString()),d&&(g+="; path="+d),e&&(g+="; domain="+e),f&&(g+="; secure="+f),document.cookie=g},window.getCookie=function(a){var b="(?:; )?"+a+"=([^;]*);?",c=new RegExp(b);return c.test(document.cookie)?decodeURIComponent(RegExp.$1):null},window.deleteCookie=function(a,b,c){setCookie(a,"",new Date(0),b,c)},window.execIgnoreError=function(a,b,c){try{a.call(b,c)}catch(d){}},window.encodeBase64=function(a){for(var b,c,d,e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",f=0,g=a.length,h="";g>f;){if(b=255&a[f++],f==g){h+=e.charAt(b>>2),h+=e.charAt((3&b)<<4),h+="==";break}if(c=a[f++],f==g){h+=e.charAt(b>>2),h+=e.charAt((3&b)<<4|(240&c)>>4),h+=e.charAt((15&c)<<2),h+="=";break}d=a[f++],h+=e.charAt(b>>2),h+=e.charAt((3&b)<<4|(240&c)>>4),h+=e.charAt((15&c)<<2|(192&d)>>6),h+=e.charAt(63&d)}return h},a.getFunction=function(b,c){if(!c)return c;if("function"==typeof b[c])return b[c];if("function"==typeof window[c])return window[c];if(-1!=c.indexOf(".")){var d=a.getJSObject(b,c);if("function"==typeof d)return d;if(d=a.getJSObject(window,c),"function"==typeof d)return d}return c},a.getJSObject=function(a,b){if(b){if("object"==typeof b)return b;for(var c=b.split("."),d=a,e=0;e<c.length;e++)if(d=d[c[e]],!d)return null;return d}}}($),+function(a){"use strict";var b="1.0.0",c="i_theme",d="i_locale",e="i_languages",f="usercode",g=-480,h="contextpath",i={version:b};window.getCookie||(window.getCookie=function(a){var b="(?:; )?"+a+"=([^;]*);?",c=new RegExp(b);return c.test(document.cookie)?decodeURIComponent(RegExp.$1):null}),window.createShellObject=function(a){var b=function(){};return b.prototype=a,new b},function(){var b={},k={},l={},m={"float":{precision:2},datetime:{format:"yyyy-MM-dd hh:mm:ss",metaType:"DateTimeFormatMeta",speratorSymbol:"-"},time:{format:"hh:mm:ss"},date:{format:"yyyy-MM-dd"},currency:{precision:2,curSymbol:"￥"}},n={};n.getEnvironment=function(){return createShellObject(b)},n.getClientAttributes=function(){return createShellObject(k)},n.setContextPath=function(a){return b[h]=a},n.getContextPath=function(){return b[h]},n.setClientAttribute=function(a,b){k[a]=b},n.getSessionAttributes=function(){return createShellObject(l)},n.setSessionAttribute=function(a,b){l[a]=b,setCookie("ISES_"+a,b)},n.removeClientAttribute=function(a){k[a]=null,execIgnoreError(function(){delete k[a]})},n.getRootComponent=function(){return this.rootComponet},n.setRootComponent=function(a){this.rootComponet=a},n.getTheme=function(){return this.getEnvironment().theme},n.getLocale=function(){return this.getEnvironment().locale},n.getLanguages=function(){return this.getEnvironment().languages},n.collectEnvironment=function(){var a=this.getEnvironment(),b=this.getSessionAttributes();for(var c in k)b[c]=k[c];return a.clientAttributes=b,a},n.changeTheme=function(d){b.theme=d,setCookie(c,d),a(document).trigger("themeChange")},n.changeLocale=function(c){b.locale=c,setCookie(d,c),a(document).trigger("localeChange")},n.setMaskerMeta=function(a,b){if(m[a])if("object"!=typeof b)m[a]=b;else for(var c in b)m[a][c]=b[c];else m[a]=b},n.getMaskerMeta=function(a){return m[a]},n.registerSystemTimeZoneOffset=function(a){g=a},n.getSystemTimeZoneOffset=function(){return g};var o={Android:function(){return/Android/i.test(navigator.userAgent)},BlackBerry:function(){return/BlackBerry/i.test(navigator.userAgent)},iOS:function(){return/iPhone|iPad|iPod/i.test(navigator.userAgent)},Windows:function(){return/IEMobile/i.test(navigator.userAgent)},any:function(){return this.Android()||this.BlackBerry()||this.iOS()||this.Windows()},pc:function(){return!this.any()},Screen:{size:j,direction:j}};n.getDevice=function(){return o},b.theme=getCookie(c),b.locale=getCookie(d),b.languages=getCookie(e)?getCookie(e).split(","):["ZH"],b.timezoneOffset=(new Date).getTimezoneOffset(),b.usercode=getCookie(f),document.cookie.replace(/ISES_(\w*)=([^;]*);?/gi,function(a,b,c){l[b]=c});var p=function(){};p.prototype=n,i.Core=new p}(),function(){var a,b=getCookie(f);if("undefined"!=typeof Log4js){a=new Log4js.Logger("iweb"),a.setLevel(Log4js.Level.ERROR);var c=new Log4js.ConsoleAppender(a,!0);a.addAppender(c)}else a={LEVEL_MAP:{OFF:Number.MAX_VALUE,ERROR:4e4,WARN:3e4,INFO:2e4,DEBUG:1e4,TRACE:5e3,ALL:1},level:4e4,setLevel:function(a){if(a){var b=this.LEVEL_MAP[a.toUpperCase()];b&&(this.level=b)}},isDebugEnabled:function(){return this.LEVEL_MAP.DEBUG>=this.level&&console},isTraceEnabled:function(){return this.LEVEL_MAP.TRACE>=this.level&&console},isInfoEnabled:function(){return this.LEVEL_MAP.INFO>=this.level&&console},isWarnEnabled:function(){return this.LEVEL_MAP.WARN>=this.level&&console},isErrorEnabled:function(){return this.LEVEL_MAP.ERROR>=this.level&&console},debug:function(){this.isDebugEnabled()&&console.debug.call(console,arguments)},warn:function(){this.isWarnEnabled()&&console.debug.call(console,arguments)},info:function(){this.isInfoEnabled()&&console.debug.call(console,arguments)},trace:function(){this.isTraceEnabled()&&console.debug.call(console,arguments)},error:function(){this.isErrorEnabled()&&console.debug.call(console,arguments)}};a.setLevel(b),i.log=a,i.debugMode=!1}(),window.iweb=i;var j=function(){}}($),+function($,ko){function _updateDom(a,b){for(var c in b){var d=b[c];for(var e in d){var f=d[e];if("trigger"==e)a.trigger(f[0]);else if($.isArray(f))$.each(f,function(b,c){a[b](c)});else try{a[c](d)}catch(g){a[c](d[c])}}}}var App=function(){this.dataTables={}};App.fn=App.prototype,App.fn.init=function(a,b){var c=this;this.element=b||document.body,$(this.element).find("[u-meta]").each(function(){if(!($(this).data("u-meta")||$(this).parents("[u-meta]").length>0)){var b=JSON.parse($(this).attr("u-meta"));if(b&&b.type){c.adjustFunc&&c.adjustFunc.call(c,b);var d=$.compManager._createComp(this,b,a,c);d&&$(this).data("u-meta",d)}}}),_getDataTables(this,a);try{ko.applyBindings(a,this.element)}catch(d){iweb.log.error(d)}},App.fn.setAdjustMetaFunc=function(a){this.adjustFunc=a},App.fn.addDataTable=function(a){return this.dataTables[a.id]=a,this},App.fn.getDataTable=function(a){return this.dataTables[a]},App.fn.getDataTables=function(){return this.dataTables},App.fn.getComp=function(a){var b=null;return $(this.element).find("[u-meta]").each(function(){if($(this).data("u-meta")){var c=$(this).data("u-meta");if(c.id==a)return b=c,!1}}),b},App.fn.getComps=function(a){a=a?a:this.element;var b=[];return $(a).find("[u-meta]").each(function(){if($(this).data("u-meta")){var a=$(this).data("u-meta");a&&b.push(a)}}),b},App.fn.compsValidate=function(a){for(var b=this.getComps(a),c=!0,d=0;d<b.length;d++)b[d].doValidate&&(c=b[d].doValidate()&&c);return c},App.fn.getCompsByType=function(a,b){b=b?b:this.element;var c=[];return $(b).find("[u-meta]").each(function(){if($(this).data("u-meta")){var b=$(this).data("u-meta");b&&b.type==a&&c.push(b)}}),c},App.fn.getEnvironment=function(){return window.iweb.Core.collectEnvironment()},App.fn.setClientAttribute=function(a,b){window.iweb.Core.setClientAttribute(a,b)},App.fn.getClientAttribute=function(a){window.iweb.Core.getClientAttributes()[a]},App.fn.serverEvent=function(){return new ServerEvent(this)},App.fn.ajax=function(a){a=this._wrapAjax(a),$.ajax(a)},App.fn._wrapAjax=function(a){var b=this,c=a.success,d=a.error,e=a.deferred;return e&&e.resolve||(e={resolve:function(){},reject:function(){}}),a.success=function(a,d,f){processXHRError(b,a,d,f)?(c.call(null,a),b._successFunc(a,e)):e.reject()},a.error=function(a,c,f){processXHRError(b,a,c,f)?(d.call(null,a),b._successFunc(a,e)):e.reject()},a.data?a.data.environment=ko.toJSON(window.iweb.Core.collectEnvironment()):a.data={environment:ko.toJSON(window.iweb.Core.collectEnvironment())},a},App.fn._successFunc=function(a,b){b.resolve()},App.fn.setUserCache=function(a,b){var c=this.getEnvironment().usercode;c&&localStorage.setItem(c+a,b)},App.fn.getUserCache=function(a){var b=this.getEnvironment().usercode;if(b)return localStorage.getItem(b+a)},App.fn.removeUserCache=function(a){var b=this.getEnvironment().usercode;b&&localStorage.removeItem(b+a)},App.fn.setCache=function(a,b){localStorage.setItem(a,b)},App.fn.getCache=function(a){return localStorage.getItem(a)},App.fn.removeCache=function(a){localStorage.removeItem(a)},App.fn.setSessionCache=function(a,b){sessionStorage.setItem(a,b)},App.fn.getSessionCache=function(a){return sessionStorage.getItem(a)},App.fn.removeSessionCache=function(a){sessionStorage.removeItem(a)},App.fn.setEnable=function(a){$(this.element).find("[u-meta]").each(function(){if($(this).data("u-meta")){var b=$(this).data("u-meta");b.setEnable&&b.setEnable(a)}})};var ServerEvent=function(a){this.app=a,this.datas={},this.params={},this.event=null,this.ent=window.iweb.Core.collectEnvironment(),window.pako&&0==iweb.debugMode&&(this.compression=!0)};ServerEvent.DEFAULT={async:!0,singleton:!0,url:(window.$ctx||"/iwebap")+"/evt/dispatch"},ServerEvent.fn=ServerEvent.prototype,ServerEvent.fn.addDataTable=function(a,b){var c=this.app.getDataTable(a);return this.datas[a]=c.getDataByRule(b),this},ServerEvent.fn.setCompression=function(a){window.pako||1!=a?this.compression=a:iweb.log.error("can't compression, please include  pako!")},ServerEvent.fn.addDataTables=function(a){for(var b=0;b<a.length;b++){var c=a[b];if("string"==typeof c)this.addDataTable(c);else for(key in c)this.addDataTable(key,c[key])}return this},ServerEvent.fn.addAllDataTables=function(a){for(var b=this.app.dataTables,c=0;c<b.length;c++)this.addDataTable(b[c].id,a)},ServerEvent.fn.addParameter=function(a,b){return this.params[a]=b,this},ServerEvent.fn.setEvent=function(a){return this.event=a,this};var _formatEvent=function(a){return a};ServerEvent.fn.fire=function(a){var b=this,c=this.getData();c.parameters=ko.toJSON(this.params);var d={type:a.type||"POST",data:a.params||{},url:a.url||ServerEvent.DEFAULT.url,async:"undefined"==typeof a.async?ServerEvent.DEFAULT.async:a.async,singleton:a.singleton||ServerEvent.DEFAULT.singleton,success:a.success,error:a.error,dataType:"json"};d.data.ctrl=a.ctrl,d.data.method=a.method,this.event&&(d.data.event=ko.toJSON(this.event));var e=d.preSuccess||function(){},f=d.success||function(){},g=d.error;this.orignError=g;var h=d.deferred;h&&h.resolve||(h={resolve:function(){},reject:function(){}}),d.success=function(a,c,d){processXHRError(b,a,c,d)?(e.call(null,a),b._successFunc(a,h),f.call(null,a.custom),h.resolve()):h.reject()},d.error=function(a,c,d){processXHRError(b,a,c,d)?g&&g.call(null,a.custom):h.reject()},d.data=$.extend(d.data,c),$.ajax(d)},ServerEvent.fn.getData=function(){var a=ko.toJSON(this.app.getEnvironment()),b=ko.toJSON(this.datas);return this.compression&&(a=encodeBase64(window.pako.gzip(a)),b=encodeBase64(window.pako.gzip(b))),{environment:a,dataTables:b,compression:this.compression}},ServerEvent.fn._successFunc=function(a,b){var c=a.dataTables,d=a.dom;d&&this.updateDom(JSON.parse(d)),c&&this.updateDataTables(c,b)},ServerEvent.fn.updateDataTables=function(a){for(var b in a){var c=this.app.getDataTable(b);c&&c.setData(a[b])}},ServerEvent.fn.setSuccessFunc=function(a){this._successFunc=a},ServerEvent.fn.updateDom=function(){$.each(dom,function(a,b){var c=b.two,d=$(b.one);_updateDom(d,c)})};var processXHRError=function(self,rsl,state,xhr){if("string"==typeof rsl&&(rsl=JSON.parse(rsl)),xhr.getResponseHeader&&xhr.getResponseHeader("X-Error")){if(!self.orignError)return $.showMessageDialog?$.showMessageDialog({type:"info",title:"提示",msg:rsl.message,backdrop:!0}):alert(rsl.message),rsl.operate&&eval(rsl.operate),!1;self.orignError.call(self,rsl,state,xhr)}return!0};$.createApp=function(){var a=new App;return a};var _getDataTables=function(a,b){for(var c in b)b[c]instanceof $.DataTable&&(b[c].id=c,a.addDataTable(b[c]))}}($,ko),+function(a){"use strict";var b=function(){};b.fn=b.prototype,b.fn.on=function(a,b){a=a.toLowerCase(),this._events||(this._events={});var c=this._events[a]||(this._events[a]=[]);return c.push({callback:b}),this},b.fn.trigger=function(a){if(a=a.toLowerCase(),!this._events||!this._events[a])return this;for(var b=Array.prototype.slice.call(arguments,1),c=this._events[a],d=0,e=c.length;e>d;d++)c[d].callback.apply(this,b);return this},b.fn.getEvent=function(a){return a=a.toLowerCase(),this._events||(this._events={}),this._events[a]};var c=function(a){this.id=a.id,this.meta=c.createMetaItems(a.meta),this.enable=a.enable||c.DEFAULTS.enable,this.pageSize=ko.observable(a.pageSize||c.DEFAULTS.pageSize),this.pageIndex=ko.observable(a.pageIndex||c.DEFAULTS.pageIndex),this.totalPages=ko.observable(a.totalPages||c.DEFAULTS.totalPages),this.totalRow=ko.observable(),this.pageCache=void 0===a.pageCache?c.DEFAULTS.pageCache:a.pageCache,this.rows=ko.observableArray([]),this.selectedIndices=ko.observableArray([]),this.focusIndex=-1,this.cachedPages=[],this.createDefaultEvents(),this.metaChange=ko.observable(1),this.valueChange=ko.observable(1),this.enableChange=ko.observable(1),this.params=a.params||{}};c.fn=c.prototype=new b,c.DEFAULTS={pageSize:20,pageIndex:0,totalPages:20,pageCache:!1,enable:!0},c.META_DEFAULTS={enable:!0,required:!1,descs:{}},c.createMetaItems=function(b){var d={};for(var e in b){var f=b[e];d[e]=a.extend({},c.META_DEFAULTS,f)}return d},c.ON_ROW_SELECT="select",c.ON_ROW_UNSELECT="unSelect",c.ON_ROW_ALLSELECT="allSelect",c.ON_ROW_ALLUNSELECT="allUnselect",c.ON_VALUE_CHANGE="valueChange",c.ON_INSERT="insert",c.ON_UPDATE="update",c.ON_DELETE="delete",c.ON_DELETE_ALL="deleteAll",c.ON_ROW_FOCUS="focus",c.ON_ROW_UNFOCUS="unFocus",c.ON_LOAD="load",c.SUBMIT={current:"current",focus:"focus",all:"all",select:"select",change:"change",empty:"empty"},c.fn.createDefaultEvents=function(){},c.fn.addParam=function(a,b){this.params[a]=b},c.fn.addParams=function(a){for(var b in a)this.params[b]=a[b]},c.fn.getParam=function(a){return this.params[a]},c.fn.getMeta=function(a,b){return 0==arguments.length?this.meta:this.meta[a][b]},c.fn.setMeta=function(a,b,c){this.meta[a][b]=c,this.metaChange(-this.metaChange()),"enable"==b&&this.enableChange(-this.enableChange())},c.fn.setCurrentPage=function(a){this.pageIndex(a);var b=this.cachedPages[this.pageIndex()];b&&(this.removeAllRows(),this.setRows(b.rows),this.setRowsSelect(b.selectedIndcies))},c.fn.isChanged=function(){for(var a=this.getAllRows(),b=0;b<a.length;b++)if(a[b].status!=d.STATUS.NORMAL)return!0;return!1},c.fn.setData=function(a){{var b=a.pageIndex,c=a.pageSize||this.pageSize(),d=a.totalPages||this.totalPages(),e=a.totalRow;a.type}this.setRows(a.rows),this.pageIndex(b),this.pageSize(c),this.totalPages(d),this.totalRow(e),this.updateSelectedIndices(),a.select&&a.select.length>0&&this.setRowsSelect(a.select),a.focus&&this.setRowFocus(a.focus)},c.fn.setRows=function(b){for(var e=0;e<b.length;e++){var f=b[e];if(f.id||(f.id=d.getRandomRowId()),f.status==d.STATUS.DELETE)this.removeRowByRowId(f.id);else{var g=this.getRowByRowId(f.id);g?(g.updateRow(f),a.isEmptyObject(f.data)||this.trigger(c.ON_UPDATE,{index:e,rows:[g]})):(g=new d({parent:this,id:f.id}),g.setData(b[e]),this.addRow(g))}}},c.fn.cacheCurrentPage=function(){this.pageCache&&(this.cachedPages[this.pageIndex()]={rows:this.rows().slice(),selectedIndcies:this.selectedIndices().slice(),pageSize:this.pageSize()})},c.fn.hasPage=function(a){return this.pageCache&&this.cachedPages[a]&&this.cachedPages[a].pageSize==this.pageSize()?!0:!1},c.fn.copyRow=function(a,b){var c=new d({parent:this});b&&c.setData(b.getData()),this.insertRows(void 0===a?this.rows().length:a,[c])},c.fn.addRow=function(a){this.insertRow(this.rows().length,a)},c.fn.insertRow=function(a,b){b||(b=new d({parent:this})),this.insertRows(a,[b])},c.fn.insertRows=function(a,b){for(var d=0;d<b.length;d++)this.rows.splice(a+d,0,b[d]),this.updateSelectedIndices(a+d,"+");this.trigger(c.ON_INSERT,{index:a,rows:b})},c.fn.createEmptyRow=function(){var a=new d({parent:this});return this.addRow(a),a},c.fn.removeRowByRowId=function(a){var b=this.getIndexByRowId(a);-1!=b&&this.removeRow(b)},c.fn.removeRow=function(a){a instanceof d&&(a=this.getIndexByRowId(a.rowId)),this.removeRows([a])},c.fn.removeAllRows=function(){this.rows([]),this.selectedIndices([]),this.trigger(c.ON_DELETE_ALL)},c.fn.removeRows=function(a){a=this._formatToIndicesArray(a),a=a.sort();for(var b=[],d=a.length-1;d>=0;d--){var e=a[d],f=this.rows()[e];null!=f&&(b.push(f.rowId),this.rows.splice(e,1),this.updateSelectedIndices(e,"-"))}this.trigger(c.ON_DELETE,{indices:a,rowIds:b})},c.fn.setRowDelete=function(a){a instanceof d&&(a=this.getIndexByRowId(a.rowId)),this.setRowDelete([a])},c.fn.setAllRowsDelete=function(){for(var a=new Array(this.rows().length),b=0;b<a.length;b++)a[b]=b;this.setRowsDelete(a)},c.fn.setRowsDelete=function(a){a=this._formatToIndicesArray(a);for(var b=0;b<a.length;b++){var e=this.getRow(a[b]);e.status==d.STATUS.NEW?(this.rows.splice(a[b],1),this.updateSelectedIndices(a[b],"-")):e.status=d.STATUS.FALSE_DELETE}var f=this.getRowIdsByIndices(a);this.trigger(c.ON_ROW_DELETE,{falseDelete:!0,indices:a,rowIds:f})},c.fn.setAllRowsSelect=function(){for(var a=new Array(this.rows().length),b=0;b<a.length;b++)a[b]=b;this.setRowsSelect(a)},c.fn.setRowSelect=function(a){a instanceof d&&(a=this.getIndexByRowId(a.rowId)),this.setRowsSelect([a]),this.setRowFocus(this.getSelectedIndex())},c.fn.setRowsSelect=function(a){a=this._formatToIndicesArray(a),this.setAllRowsUnSelect(),this.selectedIndices(a);var b=this.getRowIdsByIndices(a);this.valueChange(-this.valueChange()),this.trigger(c.ON_ROW_SELECT,{indices:a,rowIds:b})},c.fn.addRowsSelect=function(a){a=this._formatToIndicesArray(a);for(var b=this.selectedIndices().slice(),d=0;d<a.length;d++){for(var e=a[d],f=!0,g=0;g<b.length;g++)b[g]==e&&(f=!1);f&&b.push(a[d])}this.selectedIndices(b);var h=this.getRowIdsByIndices(a);this.trigger(c.ON_ROW_SELECT,{indices:a,rowIds:h})},c.fn.getRowIdsByIndices=function(a){for(var b=[],c=0;c<a.length;c++)b.push(this.getRow(a[c]).rowId);return b},c.fn.setAllRowsUnSelect=function(){this.selectedIndices([]),this.trigger(c.ON_ROW_ALLUNSELECT)},c.fn.setRowUnSelect=function(a){this.setRowsUnSelect([a])},c.fn.setRowsUnSelect=function(a){a=this._formatToIndicesArray(a);for(var b=this.selectedIndices().slice(),d=0;d<a.length;d++){var e=a[d],f=b.indexOf(e);-1!=f&&b.splice(f,1)}this.selectedIndices(b);var g=this.getRowIdsByIndices(a);this.trigger(c.ON_ROW_UNSELECT,{indices:a,rowIds:g})},c.fn.updateSelectedIndices=function(a,b){var c=this.selectedIndices().slice();if(null!=c&&0!=c.length){for(var d=0,e=c.length;e>d;d++)"+"==b?c[d]>=a&&(c[d]=parseInt(c[d])+1):"-"==b&&(c[d]==a?c.splice(d,1):c[d]>a&&(c[d]=c[d]-1));this.selectedIndices(c)}},c.fn.getSelectedIndex=function(){var a=this.selectedIndices();return null==a||0==a.length?-1:a[0]},c.fn.getSelectedIndexs=function(){var a=this.selectedIndices();return null==a||0==a.length?[]:a},c.fn.getFocusIndex=function(){return this.focusIndex},c.fn.getIndexByRowId=function(a){for(var b=0,c=this.rows().length;c>b;b++)if(this.rows()[b].rowId==a)return b;return-1},c.fn.getAllDatas=function(){for(var a=this.getAllRows(),b=[],c=0,d=a.length;d>c;c++)a[c]&&b.push(a[c].getData());return b},c.fn.getData=function(){for(var a=[],b=0;b<this.rows().length;b++)a.push(this.rows()[b].getData());return a},c.fn.getDataByRule=function(a){var b={},d=null;if(b.meta=this.meta,b.params=this.params,a=a||c.SUBMIT.current,a==c.SUBMIT.current){var e=this.focusIndex;-1==e&&(e=this.getSelectedIndex()),d=[];for(var f=0,g=this.rows().length;g>f;f++)d.push(f==e?this.rows()[f].getData():this.rows()[f].getEmptyData())}else if(a==c.SUBMIT.focus){d=[];for(var f=0,g=this.rows().length;g>f;f++)d.push(f==this.focusIndex?this.rows()[f].getData():this.rows()[f].getEmptyData())}else a==c.SUBMIT.all?d=this.getData():a==c.SUBMIT.select?d=this.getSelectedDatas(!0):a==c.SUBMIT.change?d=this.getChangedDatas():a===c.SUBMIT.empty&&(d=[]);return b.rows=d,b.select=this.getSelectedIndexs(),b.focus=this.getFocusIndex(),b.pageSize=this.pageSize(),b.pageIndex=this.pageIndex(),b.isChanged=this.isChanged(),b},c.fn.getSelectedDatas=function(a){for(var b=this.selectedIndices(),c=[],d=[],e=0,f=b.length;f>e;e++)d.push(b[e]);for(var e=0,f=this.rows().length;f>e;e++)-1!=d.indexOf(e)?c.push(this.rows()[e].getData()):1==a&&c.push(this.rows()[e].getEmptyData());return c},c.fn.refSelectedRows=function(){return ko.pureComputed({read:function(){for(var a=this.selectedIndices()||[],b=this.rows(),c=[],d=0;d<a.length;d++)c.push(b[d]);return c},owner:this})},c.fn.ref=function(a){return ko.pureComputed({read:function(){this.valueChange();var b=this.getCurrentRow();return b?b.getValue(a):""},write:function(b){var c=this.getCurrentRow();c&&c.setValue(a,b)},owner:this})},c.fn.refMeta=function(a,b){return ko.pureComputed({read:function(){return this.metaChange(),this.getMeta(a,b)},write:function(c){this.setMeta(a,b,c)},owner:this})},c.fn.refRowMeta=function(a,b){return ko.pureComputed({read:function(){this.metaChange();var c=this.getCurrentRow();return c?c.getMeta(a,b):""},write:function(b){var c=this.getCurrentRow();c&&c.setMeta(a,b)},owner:this})},c.fn.refEnable=function(a){return ko.pureComputed({read:function(){this.enableChange();var b=this.getMeta(a,"enable");return("undefined"==typeof b||null==b)&&(b=!0),b&&this.enable},owner:this})},c.fn.isEnable=function(a){var b=this.getMeta(a,"enable");return("undefined"==typeof b||null==b)&&(b=!0),b&&this.enable},c.fn.getValue=function(a,b){return b=b||this.getCurrentRow(),b?b.getValue(a):""},c.fn.setValue=function(a,b,c,d){c=c?c:this.getCurrentRow(),c&&c.setValue(a,b,d)},c.fn.setEnable=function(a){this.enable!=a&&(this.enable=a,this.enableChange(-this.enableChange()))},c.fn.getCurrentRow=function(){if(-1!=this.focusIndex)return this.getFocusRow();var a=this.getSelectedIndex();return-1==a?null:this.getRow(a)},c.fn.getFocusRow=function(){return-1!=this.focusIndex?this.getRow(this.focusIndex):null},c.fn.setRowFocus=function(a){var b=null;a instanceof d&&(a=this.getIndexByRowId(a.rowId),b=a.rowId),this.focusIndex=a,this.valueChange(-this.valueChange()),b||(b=this.getRow(a).rowId),this.trigger(c.ON_ROW_FOCUS,{index:a,rowId:b})},c.fn.setRowUnFocus=function(){this.focusIndex=-1,this.valueChange(-this.valueChange()),this.trigger(c.ON_ROW_UNFOCUS,{})},c.fn.getRow=function(a){return this.rows()[a]},c.fn.getAllRows=function(){return this.rows()},c.fn.getRowByRowId=function(a){for(var b=0,c=this.rows().length;c>b;b++)if(this.rows()[b].rowId==a)return this.rows()[b];return null},c.fn.getChangedDatas=function(a){for(var b=[],c=0,e=this.rows().length;e>c;c++)this.rows()[c]&&this.rows()[c].status!=d.STATUS.NORMAL?b.push(this.rows()[c].getData()):1==a&&b.push(this.rows()[c].getEmptyData());return b},c.fn._formatToIndicesArray=function(b){if("string"==typeof b||"number"==typeof b)b=[b];else if(b instanceof d)b=this.getIndexByRowId(b.rowId);else if("array"===a.type(b)&&b.length>0&&b[0]instanceof d)for(var c=0;c<b.length;c++)b[c]=this.getIndexByRowId(b[c].rowId);return b};var d=function(a){this.rowId=a.id||d.getRandomRowId(),this.status=d.STATUS.NEW,this.parent=a.parent,this.initValue=null,this.data={},this.metaChange=ko.observable(1),this.valueChange=ko.observable(1),this.init()};d.STATUS={NORMAL:"nrm",UPDATE:"upd",NEW:"new",DELETE:"del",FALSE_DELETE:"fdel"},d.fn=d.prototype=new b,d.fn.init=function(){var a=this.parent.meta;for(var b in a)if(this.data[b]={},a[b]["default"]){var c=a[b]["default"];for(var d in c)"value"==d?this.data[b].value=c[d]:(this.data[b].meta=this.data[b].meta||{},this.data[b].meta[d]=c[d])}},d.fn.ref=function(a){return ko.pureComputed({read:function(){return this.valueChange(),this.data[a].value},write:function(b){this.setValue(a,b)},owner:this})},d.fn.refMeta=function(a,b){return ko.pureComputed({read:function(){this.metaChange(),this.getMeta(a,b)},write:function(c){this.setMeta(a,b,c)},owner:this})},d.fn.getValue=function(a){return this.data[a].value},d.fn.setValue=function(a,b,e){var f=this.getValue(a);f!=b&&(this.data[a].value=b,this.data[a].changed=!0,this.status!=d.STATUS.NEW&&(this.status=d.STATUS.UPDATE),this.valueChange(-this.valueChange()),this.parent.getCurrentRow()==this&&this.parent.valueChange(-this.valueChange()),this.parent.trigger(c.ON_VALUE_CHANGE,{eventType:"dataTableEvent",dataTable:this.parent.id,rowId:this.rowId,field:a,oldValue:f,newValue:b,ctx:e||""}),this.parent.trigger(a+"."+c.ON_VALUE_CHANGE,{eventType:"dataTableEvent",dataTable:this.parent.id,rowId:this.rowId,field:a,oldValue:f,newValue:b,ctx:e||""}))},d.fn.getMeta=function(a,b){if(0==arguments.length){var c={};for(var d in this.data)c[d]=this.data[d].meta?this.data[d].meta:{};return c}var e=this.data[a].meta;return e&&e[b]?e[b]:this.parent.getMeta(a,b)},d.fn.setMeta=function(a,b,c){var d=this.data[a].meta;d||(d=this.data[a].meta={}),d[b]=c,this.metaChange(-this.metaChange()),"enable"==b&&this.parent.enableChange(-this.parent.enableChange())},d.fn.setData=function(b){this.status=b.status;for(var c in b.data)if(this.data[c]){var d=b.data[c];if("string"==typeof d||"number"==typeof d||null===d)this.data[c].value=this.formatValue(c,d);else if(d.error)a.showMessageDialog({title:"警告",msg:d.error,backdrop:!0});else{this.data[c].value=this.formatValue(c,d.value);for(var e in d.meta)this.setMeta(c,e,d.meta[e])}}},d.fn.formatValue=function(a,b){var c=this.parent.getMeta(a,"type");return c&&("date"==c||"datetime"==c)?e(b):b},d.fn.updateRow=function(a){this.setData(a)},d.fn.getData=function(){var a=ko.toJS(this.data),b=this.parent.getMeta();for(var c in b)b[c]&&b[c].type&&("date"==b[c].type||"datetime"==b[c].type)&&(a[c].value=f(a[c].value));return{id:this.rowId,status:this.status,data:a}},d.fn.getEmptyData=function(){return{id:this.rowId,status:this.status,data:{}}},d.getRandomRowId=function(){return setTimeout(1)};var e=function(a){var b=new Date;b.setTime(a);var c=b.getFullYear(),d=b.getMonth()+1;parseInt(d)<10&&(d="0"+d);var e=b.getDate();parseInt(e)<10&&(e="0"+e);var f=b.getHours();parseInt(f)<10&&(f="0"+f);var g=b.getMinutes();parseInt(g)<10&&(g="0"+g);var h=b.getSeconds();parseInt(h)<10&&(h="0"+h);var i=c+"-"+d+"-"+e+" "+f+":"+g+":"+h;return i},f=function(a){a.indexOf("-")>-1&&(a=a.replace(/\-/g,"/"));var b=Date.parse(a);return isNaN(b)?"":b};a.Row=d,a.DataTable=c}($),+function(a,b){"use strict";var c={plugs:{},apply:function(d,e){e=e||document.body,a(e).find("[u-meta]").each(function(){if(!(a(this).data("u-meta")||a(this).parent("[u-meta]").length>0)){var b=JSON.parse(a(this).attr("u-meta"));if(b&&b.type){var e=c._createComp(this,b,d,app);e&&a(this).data("u-meta",e)}}}),b.applyBindings(d,e)},addPlug:function(a){var b=a.getName();if(this.plugs||(this.plugs={}),this.plugs[b])throw new Error("plug has exist:"+b);this.plugs[b]=a},_createComp:function(a,b,c){var d=b.type,e=this.plugs[d];return e?new e(a,b,c):null}};a.compManager=c}($,ko)});
//# sourceMappingURL=u.min.map