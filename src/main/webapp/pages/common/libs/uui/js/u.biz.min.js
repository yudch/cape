!function(a){"function"==typeof define&&define.amd?define(["jquery","knockout"],a):a($,ko)}(function($,ko){+function(a){"use strict";function b(a){var b,c;for(b in a)c=a[b],f.Mutators.hasOwnProperty(b)?f.Mutators[b].call(this,c):this.prototype[b]=c}function c(a){return a.extend=f.extend,a.implement=b,a}function d(){}function e(a,b,c){for(var d in b)if(b.hasOwnProperty(d)){if(c&&-1===k(c,d))continue;"prototype"!==d&&(a[d]=b[d])}}var f=function(a){return this instanceof f||!j(a)?void 0:c(a)};f.create=function(a,d){function g(){a.apply(this,arguments),this.constructor===g&&this.initialize&&this.initialize.apply(this,arguments)}return j(a)||(d=a,a=null),d||(d={}),a||(a=d.Extends||f),d.Extends=a,a!==f&&e(g,a,a.StaticsWhiteList),b.call(g,d),c(g)},f.extend=function(a){return a||(a={}),a.Extends=this,f.create(a)},f.Mutators={Extends:function(a){var b=this.prototype,c=g(a.prototype);e(c,b),c.constructor=this,this.prototype=c,this.superclass=a.prototype},Implements:function(a){i(a)||(a=[a]);for(var b,c=this.prototype;b=a.shift();)e(c,b.prototype||b)},Statics:function(a){e(this,a)}};var g=Object.__proto__?function(a){return{__proto__:a}}:function(a){return d.prototype=a,new d},h=Object.prototype.toString,i=Array.isArray||function(a){return"[object Array]"===h.call(a)},j=function(a){return"[object Function]"===h.call(a)},k=Array.prototype.indexOf?function(a,b){return a.indexOf(b)}:function(a,b){for(var c=0,d=a.length;d>c;c++)if(a[c]===b)return c;return-1};a.Class=f}($),+function(a){var b=a.Class.create({initialize:function(b,c,d){this.element=b,this.id=c.id,this.options=c,this.viewModel=d;var e=c.events||{};for(var f in e)this.isDomEvent(f)?this.addDomEvent(f,a.getFunction(e[f])):this.on(f,a.getFunction(e[f]))},on:function(a,b){a=a.toLowerCase(),this._events||(this._events={});var c=this._events[a]||(this._events[a]=[]);return c.push({callback:b}),this},trigger:function(a){if(a=a.toLowerCase(),!this._events||!this._events[a])return this;for(var b=Array.prototype.slice.call(arguments,1),c=this._events[a],d=0,e=c.length;e>d;d++)c[d].callback.apply(this,b);return this},addDomEvent:function(b,c){return a(this.element).on(b,c),this},removeDomEvent:function(b){return a(this.element).off(b),this},setEnable:function(){return this},isDomEvent:function(a){return void 0===this.element["on"+a]?!1:!0},Statics:{compName:"",EVENT_VALUE_CHANGE:"valueChange",getName:function(){return this.compName}}});a.BaseComponent=b}($),+function(a){var b=a.BaseComponent.extend({initialize:function(a,c){b.superclass.initialize.apply(this,arguments),this.dataModel=null,this.hasDataTable=!1,this.parseDataModel(),this.required=c.required,this.maxLength=null,this.minLength=null,this.max=null,this.min=null,this.placement=c.placement},create:function(){var b=this;this.dataModel&&(this.hasDataTable?(this.dataModel.ref(this.field).subscribe(function(a){b.modelValueChange(a)}),this.dataModel.refEnable(this.field).subscribe(function(a){b.setEnable(a)}),this.dataModel.refRowMeta(this.field,"required").subscribe(function(a){b.required=b.required||a}),this.setEnable(this.dataModel.isEnable(this.field)),this.required=this.required||this.dataModel.getMeta(this.field,"required")):this.dataModel.subscribe(function(a){b.modelValueChange(a)}),this.modelValueChange(this.hasDataTable?this.dataModel.getValue(this.field):this.dataModel())),this.validate=a(this.element).validate({required:this.required,validType:this.validType,placement:this.placement,maxLength:this.maxLength,minLength:this.minLength,max:this.max,min:this.min}),"INPUT"!=this.element.nodeName||a(this.element).attr("type")&&"text"!=a(this.element).attr("type")||(a(this.element).focusin(function(){b.setShowValue(b.getValue())}),a(this.element).blur(function(){b.setValue(b.element.value)}))},modelValueChange:function(){},parseDataModel:function(){this.options&&this.options.data&&(this.dataModel=a.getJSObject(this.viewModel,this.options.data),this.dataModel instanceof a.DataTable&&(this.hasDataTable=!0,this.field=this.options.field))},setModelValue:function(a){this.dataModel&&(this.hasDataTable?this.dataModel.setValue(this.field,a):this.dataModel(a))},setValue:function(){},getValue:function(){return this.trueValue},setShowValue:function(){},getShowValue:function(){return this.showValue},setEnable:function(b){b===!0||"true"===b?(this.enable=!0,a(this.element).removeAttr("readonly")):(b===!1||"false"===b)&&(this.enable=!1,a(this.element).attr("readonly","readonly"))},doValidate:function(){return this.validate.check()},Statics:{}});a.InputComp=b}($),+function(a){"use strict";var b=function(){};b.fn=b.prototype,b.fn.on=function(a,b){a=a.toLowerCase(),this._events||(this._events={});var c=this._events[a]||(this._events[a]=[]);return c.push({callback:b}),this},b.fn.trigger=function(a){if(a=a.toLowerCase(),!this._events||!this._events[a])return this;for(var b=Array.prototype.slice.call(arguments,1),c=this._events[a],d=0,e=c.length;e>d;d++)c[d].callback.apply(this,b);return this},b.fn.getEvent=function(a){return a=a.toLowerCase(),this._events||(this._events={}),this._events[a]};var c=function(a){this.id=a.id,this.meta=c.createMetaItems(a.meta),this.enable=a.enable||c.DEFAULTS.enable,this.pageSize=ko.observable(a.pageSize||c.DEFAULTS.pageSize),this.pageIndex=ko.observable(a.pageIndex||c.DEFAULTS.pageIndex),this.totalPages=ko.observable(a.totalPages||c.DEFAULTS.totalPages),this.totalRow=ko.observable(),this.pageCache=void 0===a.pageCache?c.DEFAULTS.pageCache:a.pageCache,this.rows=ko.observableArray([]),this.selectedIndices=ko.observableArray([]),this.focusIndex=-1,this.cachedPages=[],this.createDefaultEvents(),this.metaChange=ko.observable(1),this.valueChange=ko.observable(1),this.enableChange=ko.observable(1),this.params=a.params||{}};c.fn=c.prototype=new b,c.DEFAULTS={pageSize:20,pageIndex:0,totalPages:20,pageCache:!1,enable:!0},c.META_DEFAULTS={enable:!0,required:!1,descs:{}},c.createMetaItems=function(b){var d={};for(var e in b){var f=b[e];d[e]=a.extend({},c.META_DEFAULTS,f)}return d},c.ON_ROW_SELECT="select",c.ON_ROW_UNSELECT="unSelect",c.ON_ROW_ALLSELECT="allSelect",c.ON_ROW_ALLUNSELECT="allUnselect",c.ON_VALUE_CHANGE="valueChange",c.ON_INSERT="insert",c.ON_UPDATE="update",c.ON_DELETE="delete",c.ON_DELETE_ALL="deleteAll",c.ON_ROW_FOCUS="focus",c.ON_ROW_UNFOCUS="unFocus",c.ON_LOAD="load",c.SUBMIT={current:"current",focus:"focus",all:"all",select:"select",change:"change",empty:"empty"},c.fn.createDefaultEvents=function(){},c.fn.addParam=function(a,b){this.params[a]=b},c.fn.addParams=function(a){for(var b in a)this.params[b]=a[b]},c.fn.getParam=function(a){return this.params[a]},c.fn.getMeta=function(a,b){return 0==arguments.length?this.meta:this.meta[a][b]},c.fn.setMeta=function(a,b,c){this.meta[a][b]=c,this.metaChange(-this.metaChange()),"enable"==b&&this.enableChange(-this.enableChange())},c.fn.setCurrentPage=function(a){this.pageIndex(a);var b=this.cachedPages[this.pageIndex()];b&&(this.removeAllRows(),this.setRows(b.rows),this.setRowsSelect(b.selectedIndcies))},c.fn.isChanged=function(){for(var a=this.getAllRows(),b=0;b<a.length;b++)if(a[b].status!=d.STATUS.NORMAL)return!0;return!1},c.fn.setData=function(a){{var b=a.pageIndex,c=a.pageSize||this.pageSize(),d=a.totalPages||this.totalPages(),e=a.totalRow;a.type}this.setRows(a.rows),this.pageIndex(b),this.pageSize(c),this.totalPages(d),this.totalRow(e),this.updateSelectedIndices(),a.select&&a.select.length>0&&this.setRowsSelect(a.select),a.focus&&this.setRowFocus(a.focus)},c.fn.setRows=function(b){for(var e=0;e<b.length;e++){var f=b[e];if(f.id||(f.id=d.getRandomRowId()),f.status==d.STATUS.DELETE)this.removeRowByRowId(f.id);else{var g=this.getRowByRowId(f.id);g?(g.updateRow(f),a.isEmptyObject(f.data)||this.trigger(c.ON_UPDATE,{index:e,rows:[g]})):(g=new d({parent:this,id:f.id}),g.setData(b[e]),this.addRow(g))}}},c.fn.cacheCurrentPage=function(){this.pageCache&&(this.cachedPages[this.pageIndex()]={rows:this.rows().slice(),selectedIndcies:this.selectedIndices().slice(),pageSize:this.pageSize()})},c.fn.hasPage=function(a){return this.pageCache&&this.cachedPages[a]&&this.cachedPages[a].pageSize==this.pageSize()?!0:!1},c.fn.copyRow=function(a,b){var c=new d({parent:this});b&&c.setData(b.getData()),this.insertRows(void 0===a?this.rows().length:a,[c])},c.fn.addRow=function(a){this.insertRow(this.rows().length,a)},c.fn.insertRow=function(a,b){b||(b=new d({parent:this})),this.insertRows(a,[b])},c.fn.insertRows=function(a,b){for(var d=0;d<b.length;d++)this.rows.splice(a+d,0,b[d]),this.updateSelectedIndices(a+d,"+");this.trigger(c.ON_INSERT,{index:a,rows:b})},c.fn.createEmptyRow=function(){var a=new d({parent:this});return this.addRow(a),a},c.fn.removeRowByRowId=function(a){var b=this.getIndexByRowId(a);-1!=b&&this.removeRow(b)},c.fn.removeRow=function(a){a instanceof d&&(a=this.getIndexByRowId(a.rowId)),this.removeRows([a])},c.fn.removeAllRows=function(){this.rows([]),this.selectedIndices([]),this.trigger(c.ON_DELETE_ALL)},c.fn.removeRows=function(a){a=this._formatToIndicesArray(a),a=a.sort();for(var b=[],d=a.length-1;d>=0;d--){var e=a[d],f=this.rows()[e];null!=f&&(b.push(f.rowId),this.rows.splice(e,1),this.updateSelectedIndices(e,"-"))}this.trigger(c.ON_DELETE,{indices:a,rowIds:b})},c.fn.setRowDelete=function(a){a instanceof d&&(a=this.getIndexByRowId(a.rowId)),this.setRowDelete([a])},c.fn.setAllRowsDelete=function(){for(var a=new Array(this.rows().length),b=0;b<a.length;b++)a[b]=b;this.setRowsDelete(a)},c.fn.setRowsDelete=function(a){a=this._formatToIndicesArray(a);for(var b=0;b<a.length;b++){var e=this.getRow(a[b]);e.status==d.STATUS.NEW?(this.rows.splice(a[b],1),this.updateSelectedIndices(a[b],"-")):e.status=d.STATUS.FALSE_DELETE}var f=this.getRowIdsByIndices(a);this.trigger(c.ON_ROW_DELETE,{falseDelete:!0,indices:a,rowIds:f})},c.fn.setAllRowsSelect=function(){for(var a=new Array(this.rows().length),b=0;b<a.length;b++)a[b]=b;this.setRowsSelect(a)},c.fn.setRowSelect=function(a){a instanceof d&&(a=this.getIndexByRowId(a.rowId)),this.setRowsSelect([a]),this.setRowFocus(this.getSelectedIndex())},c.fn.setRowsSelect=function(a){a=this._formatToIndicesArray(a),this.setAllRowsUnSelect(),this.selectedIndices(a);var b=this.getRowIdsByIndices(a);this.valueChange(-this.valueChange()),this.trigger(c.ON_ROW_SELECT,{indices:a,rowIds:b})},c.fn.addRowsSelect=function(a){a=this._formatToIndicesArray(a);for(var b=this.selectedIndices().slice(),d=0;d<a.length;d++){for(var e=a[d],f=!0,g=0;g<b.length;g++)b[g]==e&&(f=!1);f&&b.push(a[d])}this.selectedIndices(b);var h=this.getRowIdsByIndices(a);this.trigger(c.ON_ROW_SELECT,{indices:a,rowIds:h})},c.fn.getRowIdsByIndices=function(a){for(var b=[],c=0;c<a.length;c++)b.push(this.getRow(a[c]).rowId);return b},c.fn.setAllRowsUnSelect=function(){this.selectedIndices([]),this.trigger(c.ON_ROW_ALLUNSELECT)},c.fn.setRowUnSelect=function(a){this.setRowsUnSelect([a])},c.fn.setRowsUnSelect=function(a){a=this._formatToIndicesArray(a);for(var b=this.selectedIndices().slice(),d=0;d<a.length;d++){var e=a[d],f=b.indexOf(e);-1!=f&&b.splice(f,1)}this.selectedIndices(b);var g=this.getRowIdsByIndices(a);this.trigger(c.ON_ROW_UNSELECT,{indices:a,rowIds:g})},c.fn.updateSelectedIndices=function(a,b){var c=this.selectedIndices().slice();if(null!=c&&0!=c.length){for(var d=0,e=c.length;e>d;d++)"+"==b?c[d]>=a&&(c[d]=parseInt(c[d])+1):"-"==b&&(c[d]==a?c.splice(d,1):c[d]>a&&(c[d]=c[d]-1));this.selectedIndices(c)}},c.fn.getSelectedIndex=function(){var a=this.selectedIndices();return null==a||0==a.length?-1:a[0]},c.fn.getSelectedIndexs=function(){var a=this.selectedIndices();return null==a||0==a.length?[]:a},c.fn.getFocusIndex=function(){return this.focusIndex},c.fn.getIndexByRowId=function(a){for(var b=0,c=this.rows().length;c>b;b++)if(this.rows()[b].rowId==a)return b;return-1},c.fn.getAllDatas=function(){for(var a=this.getAllRows(),b=[],c=0,d=a.length;d>c;c++)a[c]&&b.push(a[c].getData());return b},c.fn.getData=function(){for(var a=[],b=0;b<this.rows().length;b++)a.push(this.rows()[b].getData());return a},c.fn.getDataByRule=function(a){var b={},d=null;if(b.meta=this.meta,b.params=this.params,a=a||c.SUBMIT.current,a==c.SUBMIT.current){var e=this.focusIndex;-1==e&&(e=this.getSelectedIndex()),d=[];for(var f=0,g=this.rows().length;g>f;f++)d.push(f==e?this.rows()[f].getData():this.rows()[f].getEmptyData())}else if(a==c.SUBMIT.focus){d=[];for(var f=0,g=this.rows().length;g>f;f++)d.push(f==this.focusIndex?this.rows()[f].getData():this.rows()[f].getEmptyData())}else a==c.SUBMIT.all?d=this.getData():a==c.SUBMIT.select?d=this.getSelectedDatas(!0):a==c.SUBMIT.change?d=this.getChangedDatas():a===c.SUBMIT.empty&&(d=[]);return b.rows=d,b.select=this.getSelectedIndexs(),b.focus=this.getFocusIndex(),b.pageSize=this.pageSize(),b.pageIndex=this.pageIndex(),b.isChanged=this.isChanged(),b},c.fn.getSelectedDatas=function(a){for(var b=this.selectedIndices(),c=[],d=[],e=0,f=b.length;f>e;e++)d.push(b[e]);for(var e=0,f=this.rows().length;f>e;e++)-1!=d.indexOf(e)?c.push(this.rows()[e].getData()):1==a&&c.push(this.rows()[e].getEmptyData());return c},c.fn.refSelectedRows=function(){return ko.pureComputed({read:function(){for(var a=this.selectedIndices()||[],b=this.rows(),c=[],d=0;d<a.length;d++)c.push(b[d]);return c},owner:this})},c.fn.ref=function(a){return ko.pureComputed({read:function(){this.valueChange();var b=this.getCurrentRow();return b?b.getValue(a):""},write:function(b){var c=this.getCurrentRow();c&&c.setValue(a,b)},owner:this})},c.fn.refMeta=function(a,b){return ko.pureComputed({read:function(){return this.metaChange(),this.getMeta(a,b)},write:function(c){this.setMeta(a,b,c)},owner:this})},c.fn.refRowMeta=function(a,b){return ko.pureComputed({read:function(){this.metaChange();var c=this.getCurrentRow();return c?c.getMeta(a,b):""},write:function(b){var c=this.getCurrentRow();c&&c.setMeta(a,b)},owner:this})},c.fn.refEnable=function(a){return ko.pureComputed({read:function(){this.enableChange();var b=this.getMeta(a,"enable");return("undefined"==typeof b||null==b)&&(b=!0),b&&this.enable},owner:this})},c.fn.isEnable=function(a){var b=this.getMeta(a,"enable");return("undefined"==typeof b||null==b)&&(b=!0),b&&this.enable},c.fn.getValue=function(a,b){return b=b||this.getCurrentRow(),b?b.getValue(a):""},c.fn.setValue=function(a,b,c,d){c=c?c:this.getCurrentRow(),c&&c.setValue(a,b,d)},c.fn.setEnable=function(a){this.enable!=a&&(this.enable=a,this.enableChange(-this.enableChange()))},c.fn.getCurrentRow=function(){if(-1!=this.focusIndex)return this.getFocusRow();var a=this.getSelectedIndex();return-1==a?null:this.getRow(a)},c.fn.getFocusRow=function(){return-1!=this.focusIndex?this.getRow(this.focusIndex):null},c.fn.setRowFocus=function(a){var b=null;a instanceof d&&(a=this.getIndexByRowId(a.rowId),b=a.rowId),this.focusIndex=a,this.valueChange(-this.valueChange()),b||(b=this.getRow(a).rowId),this.trigger(c.ON_ROW_FOCUS,{index:a,rowId:b})},c.fn.setRowUnFocus=function(){this.focusIndex=-1,this.valueChange(-this.valueChange()),this.trigger(c.ON_ROW_UNFOCUS,{})},c.fn.getRow=function(a){return this.rows()[a]},c.fn.getAllRows=function(){return this.rows()},c.fn.getRowByRowId=function(a){for(var b=0,c=this.rows().length;c>b;b++)if(this.rows()[b].rowId==a)return this.rows()[b];return null},c.fn.getChangedDatas=function(a){for(var b=[],c=0,e=this.rows().length;e>c;c++)this.rows()[c]&&this.rows()[c].status!=d.STATUS.NORMAL?b.push(this.rows()[c].getData()):1==a&&b.push(this.rows()[c].getEmptyData());return b},c.fn._formatToIndicesArray=function(b){if("string"==typeof b||"number"==typeof b)b=[b];else if(b instanceof d)b=this.getIndexByRowId(b.rowId);else if("array"===a.type(b)&&b.length>0&&b[0]instanceof d)for(var c=0;c<b.length;c++)b[c]=this.getIndexByRowId(b[c].rowId);return b};var d=function(a){this.rowId=a.id||d.getRandomRowId(),this.status=d.STATUS.NEW,this.parent=a.parent,this.initValue=null,this.data={},this.metaChange=ko.observable(1),this.valueChange=ko.observable(1),this.init()};d.STATUS={NORMAL:"nrm",UPDATE:"upd",NEW:"new",DELETE:"del",FALSE_DELETE:"fdel"},d.fn=d.prototype=new b,d.fn.init=function(){var a=this.parent.meta;for(var b in a)if(this.data[b]={},a[b]["default"]){var c=a[b]["default"];for(var d in c)"value"==d?this.data[b].value=c[d]:(this.data[b].meta=this.data[b].meta||{},this.data[b].meta[d]=c[d])}},d.fn.ref=function(a){return ko.pureComputed({read:function(){return this.valueChange(),this.data[a].value},write:function(b){this.setValue(a,b)},owner:this})},d.fn.refMeta=function(a,b){return ko.pureComputed({read:function(){this.metaChange(),this.getMeta(a,b)},write:function(c){this.setMeta(a,b,c)},owner:this})},d.fn.getValue=function(a){return this.data[a].value},d.fn.setValue=function(a,b,e){var f=this.getValue(a);f!=b&&(this.data[a].value=b,this.data[a].changed=!0,this.status!=d.STATUS.NEW&&(this.status=d.STATUS.UPDATE),this.valueChange(-this.valueChange()),this.parent.getCurrentRow()==this&&this.parent.valueChange(-this.valueChange()),this.parent.trigger(c.ON_VALUE_CHANGE,{eventType:"dataTableEvent",dataTable:this.parent.id,rowId:this.rowId,field:a,oldValue:f,newValue:b,ctx:e||""}),this.parent.trigger(a+"."+c.ON_VALUE_CHANGE,{eventType:"dataTableEvent",dataTable:this.parent.id,rowId:this.rowId,field:a,oldValue:f,newValue:b,ctx:e||""}))},d.fn.getMeta=function(a,b){if(0==arguments.length){var c={};for(var d in this.data)c[d]=this.data[d].meta?this.data[d].meta:{};return c}var e=this.data[a].meta;return e&&e[b]?e[b]:this.parent.getMeta(a,b)},d.fn.setMeta=function(a,b,c){var d=this.data[a].meta;d||(d=this.data[a].meta={}),d[b]=c,this.metaChange(-this.metaChange()),"enable"==b&&this.parent.enableChange(-this.parent.enableChange())},d.fn.setData=function(b){this.status=b.status;for(var c in b.data)if(this.data[c]){var d=b.data[c];if("string"==typeof d||"number"==typeof d||null===d)this.data[c].value=this.formatValue(c,d);else if(d.error)a.showMessageDialog({title:"警告",msg:d.error,backdrop:!0});else{this.data[c].value=this.formatValue(c,d.value);for(var e in d.meta)this.setMeta(c,e,d.meta[e])}}},d.fn.formatValue=function(a,b){var c=this.parent.getMeta(a,"type");return c&&("date"==c||"datetime"==c)?e(b):b},d.fn.updateRow=function(a){this.setData(a)},d.fn.getData=function(){var a=ko.toJS(this.data),b=this.parent.getMeta();for(var c in b)b[c]&&b[c].type&&("date"==b[c].type||"datetime"==b[c].type)&&(a[c].value=f(a[c].value));return{id:this.rowId,status:this.status,data:a}},d.fn.getEmptyData=function(){return{id:this.rowId,status:this.status,data:{}}},d.getRandomRowId=function(){return setTimeout(1)};var e=function(a){var b=new Date;b.setTime(a);var c=b.getFullYear(),d=b.getMonth()+1;parseInt(d)<10&&(d="0"+d);var e=b.getDate();parseInt(e)<10&&(e="0"+e);var f=b.getHours();parseInt(f)<10&&(f="0"+f);var g=b.getMinutes();parseInt(g)<10&&(g="0"+g);var h=b.getSeconds();parseInt(h)<10&&(h="0"+h);var i=c+"-"+d+"-"+e+" "+f+":"+g+":"+h;return i},f=function(a){a.indexOf("-")>-1&&(a=a.replace(/\-/g,"/"));var b=Date.parse(a);return isNaN(b)?"":b};a.Row=d,a.DataTable=c}($),+function(a,b){"use strict";var c={plugs:{},apply:function(d,e){e=e||document.body,a(e).find("[u-meta]").each(function(){if(!(a(this).data("u-meta")||a(this).parent("[u-meta]").length>0)){var b=JSON.parse(a(this).attr("u-meta"));if(b&&b.type){var e=c._createComp(this,b,d,app);e&&a(this).data("u-meta",e)}}}),b.applyBindings(d,e)},addPlug:function(a){var b=a.getName();if(this.plugs||(this.plugs={}),this.plugs[b])throw new Error("plug has exist:"+b);this.plugs[b]=a},_createComp:function(a,b,c){var d=b.type,e=this.plugs[d];return e?new e(a,b,c):null}};a.compManager=c}($,ko),+function(a){var b=a.InputComp.extend({initialize:function(c,d){var e=this;b.superclass.initialize.apply(this,arguments),this.maskerMeta=iweb.Core.getMaskerMeta("float")||{},this.maskerMeta.precision=d.precision||this.maskerMeta.precision,this.validType="float",this.max=d.max,this.min=d.min,this.dataModel&&this.hasDataTable&&(this.dataModel.refRowMeta(this.field,"precision").subscribe(function(a){e.setPrecision(a)}),this.maskerMeta.precision=this.dataModel.getMeta(this.field,"precision")||this.maskerMeta.precision,this.min=this.dataModel.getMeta(this.field,"min")||this.min,this.max=this.dataModel.getMeta(this.field,"max")||this.max),this.formater=new a.NumberFormater(this.maskerMeta.precision),this.masker=new NumberMasker(this.maskerMeta),this.create()},modelValueChange:function(a){if(!this.slice){a=a||"",this.trueValue=a;var b=this.formater.format(this.trueValue);this.showValue=this.masker.format(b).value,this.setShowValue(this.showValue)}},setValue:function(a){this.trueValue=this.formater.format(a),this.showValue=this.masker.format(this.trueValue).value,this.setShowValue(this.showValue),this.slice=!0,this.setModelValue(this.trueValue),this.slice=!1,this.trigger(b.EVENT_VALUE_CHANGE,this.trueValue)},getValue:function(){return this.trueValue},setShowValue:function(a){this.showValue=a,this.element.value=a},getShowValue:function(){return this.showValue},setPrecision:function(b){this.maskerMeta.precision!=b&&(this.maskerMeta.precision=b,this.formater=new a.NumberFormater(this.maskerMeta.precision),this.masker=new NumberMasker(this.maskerMeta))},Statics:{compName:"float"}});a.compManager&&a.compManager.addPlug(b)}($),+function($){var Grid=function(element,options,viewModel,app){var oThis=this;this.dataTable=$.getJSObject(viewModel,options.data),this.element=element,this.$element=$(element),this.editComponentDiv={},this.editComponent={},this.id=options.id,this.gridOptions=options,this.gridOptions.onBeforeRowSelected=$.getFunction(viewModel,this.gridOptions.onBeforeRowSelected),this.gridOptions.onRowSelected=$.getFunction(viewModel,this.gridOptions.onRowSelected),this.gridOptions.onBeforeRowUnSelected=$.getFunction(viewModel,this.gridOptions.onBeforeRowUnSelected),this.gridOptions.onRowUnSelected=$.getFunction(viewModel,this.gridOptions.onRowUnSelected),this.gridOptions.onBeforeAllRowSelected=$.getFunction(viewModel,this.gridOptions.onBeforeAllRowSelected),this.gridOptions.onAllRowSelected=$.getFunction(viewModel,this.gridOptions.onAllRowSelected),this.gridOptions.onBeforeAllRowUnSelected=$.getFunction(viewModel,this.gridOptions.onBeforeAllRowUnSelected),this.gridOptions.onAllRowUnSelected=$.getFunction(viewModel,this.gridOptions.onAllRowUnSelected),this.gridOptions.onBeforeRowFocus=$.getFunction(viewModel,this.gridOptions.onBeforeRowFocus),this.gridOptions.onRowFocus=$.getFunction(viewModel,this.gridOptions.onRowFocus),this.gridOptions.onBeforeRowUnFocus=$.getFunction(viewModel,this.gridOptions.onBeforeRowUnFocus),this.gridOptions.onRowUnFocus=$.getFunction(viewModel,this.gridOptions.onRowUnFocus),this.gridOptions.onDblClickFun=$.getFunction(viewModel,this.gridOptions.onDblClickFun),this.gridOptions.onValueChange=$.getFunction(viewModel,this.gridOptions.onValueChange);var columns=[];$("div",this.$element).each(function(){var ops=$(this).attr("options");if("undefined"==typeof ops)var column=eval("("+ops+")");else var column=JSON.parse(ops);var eType=$.getFunction(viewModel,column.editType),rType=$.getFunction(viewModel,column.renderType),eOptions={};if(column.editOptions)if("undefined"==typeof column.editOptions)var eOptions=eval("("+column.editOptions+")");else var eOptions=column.editOptions;if(eOptions.data=options.data,eOptions.field=column.field,""==eType&&(eType="string"),"string"==eType||"checkbox"==eType||"combo"==eType||"radio"==eType||"float"==eType||"datetime"==eType||"date"==eType){if("string"==eType)var compDiv=$('<input type="text" style="width:100%;margin:0px;min-height:20px;font-size:12px;color:#444">'),comp=new $.compManager.plugs.string(compDiv[0],eOptions,viewModel);else if("checkbox"==eType)var compDiv=$('<input id="'+oThis.id+"_edit_field_"+column.field+'" type="checkbox">'),comp=new $.compManager.plugs.checkbox(compDiv[0],eOptions,viewModel);else if("combo"==eType)var compDiv=$("<div>"),comp=new $.compManager.plugs.combo(compDiv[0],eOptions,viewModel);else if("radio"==eType)var compDiv=$('<input id="'+oThis.id+"_edit_field_"+column.field+'" type="text">'),comp=new $.compManager.plugs.radio(compDiv[0],eOptions,viewModel);else if("float"==eType)var compDiv=$('<input id="'+oThis.id+"_edit_field_"+column.field+'" type="text">'),comp=new $.compManager.plugs["float"](compDiv[0],eOptions,viewModel);else if("datetime"==eType)var compDiv=$('<input id="'+oThis.id+"_edit_field_"+column.field+'" type="text">'),comp=new $.compManager.plugs.datetime(compDiv[0],eOptions,viewModel);oThis.editComponentDiv[column.field]=compDiv,oThis.editComponent[column.field]=comp,column.editType=function(a){a.element.innerHTML="";var b=$('<div class="u-grid-content-td-div" style="margin:0px;"></div>'),c=(oThis.getDataTableRow(a.rowObj),oThis.editComponent[column.field]);$(a.element).append(b),b.append(oThis.editComponentDiv[column.field]),c.modelValueChange(a.value)}}else"function"==typeof eType&&(column.editType=eType);"booleanRender"==rType?column.renderType=function(a){var b="";"Y"==a.value&&(b="checked");var c='<input type="checkbox" readOnly '+b+">";a.element.innerHTML=c}:"integerRender"==rType?column.renderType=function(){}:"floatRender"==rType?column.renderType=function(){}:"comboRender"==rType?column.renderType=function(a){var b=$.getJSObject(viewModel,eOptions.datasource);window.item&&(a.value=item.pk,window.item=null);for(var c=a.value,d=0,e=b.length;e>d;d++)if(b[d].pk==c){a.element.innerHTML=b[d].name;break}}:"dateRender"==rType||"dateTimeRender"==rType||"function"==typeof rType&&(column.renderType=rType),columns.push(column)}),app&&app.adjustFunc&&app.adjustFunc.call(app,{id:this.id,type:"gridColumn",columns:columns}),this.gridOptions.columns=columns;var onRowSelectedFun=this.gridOptions.onRowSelected;this.gridOptions.onRowSelected=function(a){var b=oThis.grid.dataSourceObj.rows[a.rowIndex].value["$_#_@_id"],c=oThis.dataTable.getIndexByRowId(b);oThis.grid.options.multiSelect?oThis.dataTable.addRowsSelect([c]):oThis.dataTable.setRowSelect(c),onRowSelectedFun&&onRowSelectedFun.call(oThis,a)},this.dataTable.on($.DataTable.ON_ROW_SELECT,function(a){$.each(a.rowIds,function(){var a=oThis.grid.getRowIndexByValue("$_#_@_id",this);a>-1&&oThis.grid.setRowSelect(parseInt(a))})});var onRowUnSelectedFun=this.gridOptions.onRowUnSelected;this.gridOptions.onRowUnSelected=function(a){var b=oThis.grid.dataSourceObj.rows[a.rowIndex].value["$_#_@_id"],c=oThis.dataTable.getIndexByRowId(b);oThis.dataTable.setRowUnSelect(c),onRowUnSelectedFun&&onRowUnSelectedFun.call(oThis,a)},this.dataTable.on($.DataTable.ON_ROW_UNSELECT,function(a){$.each(a.rowIds,function(){var a=oThis.grid.getRowIndexByValue("$_#_@_id",this);a>-1&&oThis.grid.setRowUnselect(parseInt(a))})});var onRowFocusFun=this.gridOptions.onRowFocus;this.gridOptions.onRowFocus=function(a){var b=oThis.grid.dataSourceObj.rows[a.rowIndex].value["$_#_@_id"],c=oThis.dataTable.getIndexByRowId(b);oThis.dataTable.setRowFocus(c),onRowFocusFun&&onRowFocusFun.call(oThis,a)},this.dataTable.on($.DataTable.ON_ROW_FOCUS,function(a){var b=oThis.grid.getRowIndexByValue("$_#_@_id",a.rowId);b>-1&&oThis.grid.setRowFocus(parseInt(b))});var onRowUnFocusFun=this.gridOptions.onRowUnFocus;this.gridOptions.onRowUnFocus=function(a){var b=oThis.grid.dataSourceObj.rows[a.rowIndex].value["$_#_@_id"],c=oThis.dataTable.getIndexByRowId(b);oThis.dataTable.setRowUnFocus(c),onRowUnFocusFun&&onRowUnFocusFun.call(oThis,a)},this.dataTable.on($.DataTable.ON_ROW_UNFOCUS,function(a){$.each(a.rowIds,function(){var a=oThis.grid.getRowIndexByValue("$_#_@_id",this);a>-1&&oThis.grid.setRowUnFocus(parseInt(a))})}),this.dataTable.on($.DataTable.ON_INSERT,function(a){var b=new Array;$.each(a.rows,function(){var a=this.data,c=this.rowId,d={};for(var e in a)d[e]=a[e].value;d["$_#_@_id"]=c,b.push(d)}),oThis.grid.addRows(b,a.index)}),this.dataTable.on($.DataTable.ON_UPDATE,function(a){$.each(a.rows,function(){var a=this.data,b=this.rowId,c={};for(var d in a)c[d]=a[d].value;c["$_#_@_id"]=b;var e=oThis.grid.getRowIndexByValue("$_#_@_id",b);oThis.grid.updateRow(e,c)})}),this.dataTable.on($.DataTable.ON_VALUE_CHANGE,function(a){var b=a.rowId,c=oThis.grid.getRowIndexByValue("$_#_@_id",b),d=a.field,e=a.newValue;oThis.grid.updateValueAt(c,d,e)}),this.dataTable.on($.DataTable.ON_DELETE,function(a){var b=new Array;$.each(a.rowIds,function(){var a=oThis.grid.getRowIndexByValue("$_#_@_id",this);b.push(a)}),oThis.grid.deleteRows(b)}),this.dataTable.on($.DataTable.ON_DELETE_ALL,function(){oThis.grid.setDataSource({})});var onValueChangeFun=this.gridOptions.onValueChange;this.gridOptions.onValueChange=function(a){var b=oThis.getDataTableRow(oThis.grid.dataSourceObj.rows[a.rowIndex].value);b&&("object"==$.type(a.newValue)?(b.setValue(a.field,a.newValue.trueValue),b.setMeta(a.field,"display",a.newValue.showValue)):b.setValue(a.field,a.newValue)),onValueChangeFun&&onValueChangeFun.call(oThis,a)},this.dataTable.on("valueChange",function(a){var b=a.field,c=a.rowId,d=(a.oldValue,a.newValue),e=oThis.grid.getRowIndexByValue("$_#_@_id",c);e>-1&&oThis.grid.updateValueAt(e,b,d)}),this.dataTable.on($.DataTable.ON_LOAD,function(a){if(a.length>0){var b=new Array;$.each(a,function(){var a={},c=this.data,d=this.rowId;for(var e in c){var f=c[e].value;a[e]=f}a["$_#_@_id"]=d,b.push(a)});var c={};c.values=b,oThis.grid.setDataSource(c)}}),this.grid=$(element).grid(this.gridOptions),this.grid.dataTable=this.dataTable,this.grid.viewModel=viewModel;var data=this.dataTable.rows();if(data.length>0){var values=new Array;$.each(data,function(){var a={},b=this.data,c=this.rowId;for(var d in b){var e=b[d].value;a[d]=e}a["$_#_@_id"]=c,values.push(a)});var dataSource={};dataSource.values=values,oThis.grid.setDataSource(dataSource)}var selectIndexs=this.dataTable.getSelectedIndexs();return selectIndexs.length>0&&$.each(selectIndexs,function(){oThis.grid.setRowSelect(this)}),this};Grid.getName=function(){return"grid"},Grid.fn=Grid.prototype,Grid.fn.getDataTableRow=function(a){var b=a["$_#_@_id"],c=null,d=this.dataTable.getIndexByRowId(b);return d>-1&&(c=this.dataTable.getRow(d)),c},Grid.fn.setEnable=function(a){this.grid.setEditable(a)},$.compManager&&$.compManager.addPlug(Grid)}($),+function($){var Tree=function(element,options,viewModel){var oThis=this;this.dataTable=$.getJSObject(viewModel,options.data),this.element=element,this.$element=$(element),this.id=options.id,this.element.id=this.id,this.options=options,this.events=$.extend(!0,{},options.events);var treeSettingDefault={data:{simpleData:{enable:!0}},check:{chkboxType:{Y:"",N:""}},callback:{beforeClick:function(a,b,c){oThis.events.beforeClick&&$.getFunction(viewModel,oThis.events.beforeClick)(a,b,c)},onCheck:function(a,b,c){var d=c.id,e=oThis.getRowIdByIdValue(d),f=oThis.dataTable.getIndexByRowId(e);c.checked?oThis.options.multiSelect?oThis.dataTable.addRowsSelect([f]):oThis.dataTable.setRowSelect(f):oThis.dataTable.setRowUnSelect(f)},onClick:function(a,b,c){if(!oThis.options.multiSelect){var d=c.id,e=oThis.getRowIdByIdValue(d),f=oThis.dataTable.getIndexByRowId(e);oThis.dataTable.setRowSelect(f),oThis.events.onClick&&$.getFunction(viewModel,oThis.events.onClick)(a,b,c)}}}},setting={};this.options.setting&&(setting="undefined"==typeof JSON?eval("("+this.options.setting+")"):$.getJSObject(viewModel,this.options.setting)||$.getJSObject(window,this.options.setting));var treeSetting=$.extend({},treeSettingDefault,setting),treeData=[],data=this.dataTable.rows();if(data.length>0)if(this.options.codeTree){data.sort(function(a,b){var c=a.data,d=b.data,e=c[oThis.options.idField].value+"",f=d[oThis.options.idField].value+"";try{return e.localeCompare(f)}catch(g){return 0}});var idArr=new Array;$.each(data,function(){var a=this.data,b=a[oThis.options.idField].value;idArr.push(b)});var preValue="";$.each(data,function(){var a={},b=this.data,c=b[oThis.options.idField].value,d=b[oThis.options.nameField].value,e="",f=-1;if(""!=preValue)var f=c.indexOf(preValue);if(0==f)e=preValue;else for(var g=1;g<preValue.length;g++){var h=preValue.substr(0,g),i=c.indexOf(h);if(0!=i)break;var j=$.inArray(h,idArr);(j>0||0==j)&&(e=h)}a.id=c,a.pId=e,a.name=d,treeData.push(a),preValue=c})}else{var values=new Array;
$.each(data,function(){var a={},b=this.data,c=b[oThis.options.idField].value,d=b[oThis.options.pidField].value,e=b[oThis.options.nameField].value;a.id=c,a.pId=d,a.name=e,treeData.push(a)})}return this.tree=$.fn.zTree.init(this.$element,treeSetting,treeData),this.dataTable.on($.DataTable.ON_ROW_SELECT,function(a){$.each(a.rowIds,function(){var a=oThis.dataTable.getRowByRowId(this),b=a.data,c=b[oThis.options.idField].value,d=oThis.tree.getNodeByParam("id",c);oThis.options.multiSelect&&!d.checked?oThis.tree.checkNode(d):oThis.tree.selectNode(d,!1)})}),this.dataTable.on($.DataTable.ON_ROW_UNSELECT,function(a){$.each(a.rowIds,function(){var a=oThis.dataTable.getRowByRowId(this),b=a.data,c=b[oThis.options.idField].value,d=oThis.tree.getNodeByParam("id",c);oThis.options.multiSelect&&d.checked?oThis.tree.checkNode(d):oThis.tree.cancelPreSelectedNode(treeSetting,d)})}),this.dataTable.on($.DataTable.ON_INSERT,function(a){new Array;$.each(a.rows,function(){var a={},b=this.data,c=b[oThis.options.idField].value,d=b[oThis.options.pidField].value,e=b[oThis.options.nameField].value;a.id=c,a.pId=d,a.name=e;var f=oThis.tree.getNodeByParam("id",d);oThis.tree.addNodes(f,a,!0)})}),this.dataTable.on($.DataTable.ON_DELETE,function(a){new Array;$.each(a.rowIds,function(){var a=oThis.dataTable.getRowByRowId(this),b=a.data,c=b[oThis.options.idField].value,d=oThis.tree.getNodeByParam("id",c);oThis.tree.removeNode(d)})}),this.dataTable.on($.DataTable.ON_DELETE_ALL,function(){for(var a=oThis.tree.getNodes(),b=0,c=a.length;c>b;b++)oThis.tree.removeNode(a[b])}),this.dataTable.on($.DataTable.ON_LOAD,function(a){var a=oThis.dataTable.rows();if(a.length>0){{new Array}$.each(a,function(){var a={},b=this.data,c=b[oThis.options.idField].value,d=b[oThis.options.pidField].value,e=b[oThis.options.nameField].value;a.id=c,a.pId=d,a.name=e,treeData.push(a)})}this.tree=$.fn.zTree.init(this.$element,treeSetting,treeData)}),this.getRowIdByIdValue=function(a){var b=this,c=null;return $.each(this.dataTable.rows(),function(){var d=this.data,e=this.rowId;d[b.options.idField].value==a&&(c=e)}),c},this};Tree.getName=function(){return"tree"},$.compManager&&$.compManager.addPlug(Tree)}($),+function(a){var b=a.InputComp.extend({initialize:function(c,d,e){var f=this;b.superclass.initialize.apply(this,arguments),this.datasource=a.getJSObject(e,d.datasource),this.single=d.single,this.mutil=d.mutil,this.comboEle=a(this.element).children().length>0?a(this.element).find("div")[0]:this.element,this.create(),this.comp=a(this.comboEle).Combobox({dataSource:this.datasource,single:this.single,mutil:this.mutil,onSelect:function(a){f.setValue(a.pk),f.trigger("onSelect",a)}})},addDomEvent:function(b,c){return a(this.comboEle).on(b,c),this},removeDomEvent:function(b){a(this.comboEle).off(b)},modelValueChange:function(b){this.slice||(this.trueValue=b,a(this.comboEle).val(b))},setValue:function(c){this.trueValue=c,a(this.comboEle).val(c),this.slice=!0,this.setModelValue(this.trueValue),this.slice=!1,this.trigger(b.EVENT_VALUE_CHANGE,this.trueValue)},getValue:function(){return this.trueValue},setEnable:function(b){b===!0||"true"===b?(this.enable=!0,a(this.comboEle).data("enable",!0)):(b===!1||"false"===b)&&(this.enable=!1,a(this.comboEle).data("enable",!1))},Statics:{compName:"combo"}});a.compManager&&a.compManager.addPlug(b)}($),+function(a){var b=a.InputComp.extend({initialize:function(c,d){var e=this;b.superclass.initialize.apply(this,arguments),this.maxLength=d.maxLength,this.minLength=d.minLength,this.dataModel&&this.hasDataTable&&(this.minLength=this.dataModel.getMeta(this.field,"minLength")||this.minLength,this.maxLength=this.dataModel.getMeta(this.field,"maxLength")||this.maxLength),this.create(),"INPUT"==this.element.nodeName&&(a(this.element).focusin(function(){e.setShowValue(e.getValue())}),a(this.element).blur(function(){e.setValue(e.element.value)}))},modelValueChange:function(a){this.slice||(a=a||"",this.trueValue=a,this.showValue=a,this.setShowValue(this.showValue))},setValue:function(a){this.trueValue=a,this.showValue=a,this.setShowValue(this.showValue),this.slice=!0,this.setModelValue(this.trueValue),this.slice=!1,this.trigger(b.EVENT_VALUE_CHANGE,this.trueValue)},getValue:function(){return this.trueValue},setShowValue:function(a){this.showValue=a,this.element.value=a},getShowValue:function(){return this.showValue},Statics:{compName:"string"}});a.StringComp=b,a.compManager&&a.compManager.addPlug(b)}($),+function(a){var b=a.InputComp.extend({initialize:function(){var c=this;b.superclass.initialize.apply(this,arguments),this.create(),a.app&&a(this.element).wrap("<label class='label-switch'></div>").after("<div class='checkbox'></div>").css("display","none"),a(this.element).on("click",function(){var a=this.checked?"Y":"N";c.setValue(a)})},modelValueChange:function(a){this.slice||(a=a||"",this.trueValue=a,this.showValue="Y"==a||"true"==a?!0:"N"==a||"false"==a?!1:!1,this.setShowValue(this.showValue))},setValue:function(a){this.trueValue=a,this.showValue="Y"==a||"true"==a?!0:"N"==a||"false"==a?!1:!1,this.setShowValue(this.showValue),this.slice=!0,this.setModelValue(this.trueValue),this.slice=!1,this.trigger(b.EVENT_VALUE_CHANGE,this.trueValue)},getValue:function(){return this.trueValue},setShowValue:function(a){this.showValue=a,this.element.checked=a},getShowValue:function(){return this.showValue},Statics:{compName:"check"}});a.compManager&&a.compManager.addPlug(b)}($),+function(a){var b=a.InputComp.extend({initialize:function(c,d,e){var f=this;b.superclass.initialize.apply(this,arguments);var g=a.getJSObject(e,d.datasource);if(a.isArray(g)){for(var h=a(this.element).children(),i=0,j=g.length-1;j>i;i++)h.clone().appendTo(this.element);for(var k=a(this.element).children("[type=checkbox]"),l=a(this.element).children("[data-role=name]"),m=0;m<k.length;m++)k[m].value=g[m].pk,l[m].innerHTML=g[m].name;this.create(),this.valArr=[],a(this.element).find(":checkbox").each(function(){a(this).on("click",function(){if(0==f.valArr.length)this.checked&&f.valArr.push(this.value);else if(this.checked){for(var a=null,b=0;b<f.valArr.length;b++)this.value==f.valArr[b]&&(a=b);null==a&&f.valArr.push(this.value)}else for(var c=0;c<f.valArr.length;c++)this.value==f.valArr[c]&&f.valArr.splice(c,1);f.setValue(f.valArr.toString())})})}},modelValueChange:function(b){if(!this.slice){b=b||"",this.trueValue=b;var c=b.split(",");a(this.element).find(":checkbox").each(function(){for(var a=0;a<c.length;a++)this.value==c[a]&&(this.checked=!0)})}},setValue:function(c){this.trueValue=c;var d=c;a(this.element).find(":checkbox").each(function(){for(var a=0;a<d.length;a++)this.value==d[a]&&(this.checked=!0)}),this.slice=!0,this.setModelValue(this.trueValue),this.slice=!1,this.trigger(b.EVENT_VALUE_CHANGE,this.trueValue)},getValue:function(){return this.trueValue},Statics:{compName:"checkboxGroup"}});a.compManager&&a.compManager.addPlug(b)}($),+function(a){var b=a.InputComp.extend({initialize:function(c,d){var e=this;b.superclass.initialize.apply(this,arguments),this.maskerMeta=iweb.Core.getMaskerMeta("datetime")||{},this.maskerMeta.format=d.format||this.maskerMeta.format,this.dataModel&&this.hasDataTable&&(this.dataModel.refRowMeta(this.field,"format").subscribe(function(a){e.setFormat(a)}),this.maskerMeta.format=this.dataModel.getMeta(this.field,"format")||this.maskerMeta.format),this.options.picker_type="datetime",this.options.format="YYYY-M-D  HH:ss",this.formater=new a.DateFormater(this.maskerMeta.format),this.masker=new DateTimeMasker(this.maskerMeta),this.create(),this.comp=a(this.element).datetimepicker(this.options),a(this.element).find("input").focusin(function(){e.setShowValue(e.getValue())}).blur(function(){e.setValue(this.value)})},modelValueChange:function(a){this.slice||(a=a||"",this.trueValue=a,this.showValue=a,this.setShowValue(this.showValue))},setValue:function(a){this.trueValue=a,this.setShowValue(this.trueValue),this.slice=!0,this.setModelValue(a),this.slice=!1,this.trigger(b.EVENT_VALUE_CHANGE,this.trueValue)},getValue:function(){return this.trueValue},setShowValue:function(b){this.showValue=b,this.element.value=b,a(this.element).find("input").val(b),a(this.element).data("DateTimePicker")&&a(this.element).data("DateTimePicker").date(b)},getShowValue:function(){return this.showValue},setFormat:function(b){this.maskerMeta.format!=b&&(this.maskerMeta.format=b,this.formater=new a.DateFormater(this.maskerMeta.format),this.masker=new DateTimeMasker(this.maskerMeta))},setEnable:function(b){b===!0||"true"===b?(this.enable=!0,a.app||a(this.element).find("input").removeAttr("readonly"),a(this.element).find("input").attr("h7picker","true")):(b===!1||"false"===b)&&(this.enable=!1,a(this.element).find("input").attr("h7picker","false"),a(this.element).find("input").attr("readonly","readonly"))},Statics:{compName:"datetime"}}),c=b.extend({initialize:function(c,d){var e=this;b.superclass.initialize.apply(this,arguments),this.maskerMeta=iweb.Core.getMaskerMeta("date")||{},this.maskerMeta.format=d.format||this.maskerMeta.format,this.dataModel&&this.hasDataTable&&(this.dataModel.refRowMeta(this.field,"format").subscribe(function(a){e.setFormat(a)}),this.maskerMeta.format=this.dataModel.getMeta(this.field,"format")||this.maskerMeta.format),this.options.picker_type="datecomp",this.options.format="YYYY-M-D  ",this.formater=new a.DateFormater(this.maskerMeta.format),this.masker=new DateMasker(this.maskerMeta),this.create(),this.comp=a(this.element).datetimepicker(this.options)},setFormat:function(b){this.maskerMeta.format!=b&&(this.maskerMeta.format=b,this.formater=new a.DateFormater(this.maskerMeta.format),this.masker=new DateMasker(this.maskerMeta))},Statics:{compName:"date"}});a.compManager&&(a.compManager.addPlug(b),a.compManager.addPlug(c))}($),+function(a){var b=a.InputComp.extend({initialize:function(c,d,e){var f=this;b.superclass.initialize.apply(this,arguments);var g=a.getJSObject(e,d.datasource);if(a.isArray(g)){for(var h=a(this.element).children(),i=0,j=g.length-1;j>i;i++)h.clone().appendTo(this.element);for(var k=a(this.element).children("[type=radio]"),l=a(this.element).children("[data-role=name]"),m=0;m<k.length;m++)k[m].value=g[m].pk,l[m].innerHTML=g[m].name;this.radioInputName=k[0].name,this.create(),a(this.element).find(":radio[name='"+this.radioInputName+"']").each(function(){a(this).on("click",function(){this.checked&&f.setValue(this.value)})})}},modelValueChange:function(b){this.slice||(b=b||"",this.trueValue=b,a(this.element).find(":radio[name='"+this.radioInputName+"']").each(function(){this.value==b&&(this.checked=!0)}))},setValue:function(c){this.trueValue=c,a(this.element).find(":radio[name='"+this.radioInputName+"']").each(function(){this.value==c&&(this.checked=!0)}),this.slice=!0,this.setModelValue(this.trueValue),this.slice=!1,this.trigger(b.EVENT_VALUE_CHANGE,this.trueValue)},getValue:function(){return this.trueValue},Statics:{compName:"radio"}});a.compManager&&a.compManager.addPlug(b)}($),+function(a){var b=a.InputComp.extend({initialize:function(a,c){b.superclass.initialize.apply(this,arguments),this.max=c.max,this.min=c.min,this.dataModel&&this.hasDataTable&&(this.min=this.dataModel.getMeta(this.field,"min")||this.min,this.max=this.dataModel.getMeta(this.field,"max")||this.max),this.create()},modelValueChange:function(a){this.slice||(a=a||"",this.trueValue=a,this.showValue=a,this.setShowValue(this.showValue))},setValue:function(a){this.trueValue=a,this.showValue=a,this.setShowValue(this.showValue),this.slice=!0,this.setModelValue(this.trueValue),this.slice=!1,this.trigger(b.EVENT_VALUE_CHANGE,this.trueValue)},getValue:function(){return this.trueValue},setShowValue:function(a){this.showValue=a,this.element.value=a},getShowValue:function(){return this.showValue},Statics:{compName:"integer"}});a.compManager&&a.compManager.addPlug(b)}($),+function(a){var b=a.InputComp.extend({initialize:function(c,d){var e=this;b.superclass.initialize.apply(this,arguments),this.maskerMeta=iweb.Core.getMaskerMeta("currency")||{},this.maskerMeta.precision=d.precision||this.maskerMeta.precision,this.maskerMeta.curSymbol=d.curSymbol||this.maskerMeta.curSymbol,this.validType="float",this.max=d.max,this.min=d.min,this.dataModel&&this.hasDataTable&&(this.dataModel.refRowMeta(this.field,"precision").subscribe(function(a){e.setPrecision(a)}),this.maskerMeta.precision=this.dataModel.getMeta(this.field,"precision")||this.maskerMeta.precision,this.dataModel.refRowMeta(this.field,"curSymbol").subscribe(function(a){e.setCurSymbol(a)}),this.maskerMeta.curSymbol=this.dataModel.getMeta(this.field,"curSymbol")||this.maskerMeta.curSymbol,this.min=this.dataModel.getMeta(this.field,"min")||this.min,this.max=this.dataModel.getMeta(this.field,"max")||this.max),this.formater=new a.NumberFormater(this.maskerMeta.precision),this.masker=new CurrencyMasker(this.maskerMeta),this.create()},modelValueChange:function(a){if(!this.slice){a=a||"",this.trueValue=a;var b=this.formater.format(this.trueValue);this.showValue=this.masker.format(b).value,this.setShowValue(this.showValue)}},setValue:function(a){this.trueValue=this.formater.format(a),this.showValue=this.masker.format(this.trueValue).value,this.setShowValue(this.showValue),this.slice=!0,this.setModelValue(this.trueValue),this.slice=!1,this.trigger(b.EVENT_VALUE_CHANGE,this.trueValue)},getValue:function(){return this.trueValue},setShowValue:function(a){this.showValue=a,this.element.value=a},getShowValue:function(){return this.showValue},setPrecision:function(b){this.maskerMeta.precision!=b&&(this.maskerMeta.precision=b,this.formater=new a.NumberFormater(this.maskerMeta.precision),this.masker=new CurrencyMasker(this.maskerMeta))},setCurSymbol:function(a){this.maskerMeta.curSymbol!=a&&(this.maskerMeta.curSymbol=a,this.masker=new CurrencyMasker(this.maskerMeta))},Statics:{compName:"currency"}});a.compManager&&a.compManager.addPlug(b)}($),+function(a){var b=a.InputComp.extend({initialize:function(c,d){var e=this;b.superclass.initialize.apply(this,arguments),this.create();var f=iweb.Core.getLanguages();d.multinfo&&(f=d.multinfo);var g=[];for(this.field=d.field,f.lang_name=d.field,i=0;i<f.length;i++)g.push(i?" ":" ");this.multinfo=f,this.multidata=g,a(c).multilang({multinfo:f,multidata:g}),this.$element=a(c),this.$element.on("change.u.multilang",function(a,b){e.setModelValue(b)})},create:function(){var a=this;this.dataModel&&(this.hasDataTable?(this.dataModel.ref(this.field).subscribe(function(b){a.modelValueChange(b)}),this.dataModel.refEnable(this.field).subscribe(function(b){a.setEnable(b)}),this.setEnable(this.dataModel.isEnable(this.field))):this.dataModel.subscribe(function(b){a.modelValueChange(b)}),this.modelValueChange(this.hasDataTable?this.dataModel.getValue(this.field):this.dataModel()))},parseDataModel:function(){this.options&&this.options.data&&(this.dataModel=a.getJSObject(this.viewModel,this.options.data),this.dataModel instanceof a.DataTable&&(this.hasDataTable=!0,this.field=this.options.field))},setModelValue:function(a){this.dataModel&&(this.hasDataTable?this.dataModel.setValue(a.field,a.newValue):this.dataModel(a.newValue))},modelValueChange:function(a){var b=this;if(this.multidata){for(b.multidata[0]=a,i=1;i<b.multinfo.length;i++)i&&(b.multidata[i]=b.dataModel.getValue(this.field+(i+1),b.dataTableRow));this.$element.multilang({multidata:b.multidata})}},modelValuelangChange:function(){},Statics:{compName:"multilang"}});a.compManager&&a.compManager.addPlug(b)}($),+function(a){var b=function(b,c,d){var e=this;this.dataTable=a.getJSObject(d,c.data),this.element=b,this.$element=a(b),c.pageSize&&this.dataTable.pageSize(c.pageSize),this.pagination=this.$element.pagination(c),this.pagination.dataTable=this.dataTable,this.$element.on("pageChange",function(b,c){var f=parseInt(a(b.target.lastChild).find(".page_z").val());e.dataTable.cacheCurrentPage(),d.pageChange(c-1,f)}),this.dataTable.totalPages.subscribe(function(a){e.pagination.update({totalPages:a})}),this.dataTable.pageSize.subscribe(function(a){e.pagination.update({pageSize:a})}),this.dataTable.pageIndex.subscribe(function(a){e.pagination.update({currentPage:a})})};b.getName=function(){return"pagination"},a.compManager&&a.compManager.addPlug(b)}($),+function(a){var b=a.InputComp.extend({initialize:function(a,c,d){this.element=a,this.id=c.id,this.options=c,this.viewModel=d,this.e_editor=this.id+"editor",this.render(this.options),b.superclass.initialize.apply(this,arguments),this.create()},render:function(b){var c=b.cols||80,d=b.rows||10,e=this,f='<textarea cols="'+c+'" id="'+this.e_editor+'" name="editor" rows="'+d+'"></textarea>';a(this.element).append(f),a("#"+this.e_editor).ckeditor();var g=CKEDITOR.instances[this.e_editor];this.tmpeditor=g,this.tmpeditor.on("blur",function(){e.setValue(g.getData())}),this.tmpeditor.on("focus",function(){e.setShowValue(e.getValue())})},modelValueChange:function(a){this.slice||(a=a||"",this.trueValue=a,this.showValue=a,this.setShowValue(this.showValue))},setValue:function(a){this.trueValue=a,this.showValue=a,this.setShowValue(this.showValue),this.slice=!0,this.setModelValue(this.trueValue),this.slice=!1,this.trigger(b.EVENT_VALUE_CHANGE,this.trueValue)},getValue:function(){return this.trueValue},setShowValue:function(a){this.showValue=a,this.element.value=a,this.tmpeditor.setData(a)},getShowValue:function(){return this.showValue},getContent:function(){return a("#"+this.e_editor).html()},setContent:function(b){a("#"+this.e_editor).html(b)},Statics:{compName:"editor"}});a.compManager&&a.compManager.addPlug(b)}($),+function(a){var b=a.BaseComponent.extend({initialize:function(b,c,d){if(a.InputComp.superclass.initialize.apply(this,arguments),this.dataModel=null,this.hasDataTable=!1,this.parseDataModel(),c.click){var e=a.getJSObject(d,c.click);this.on("click",e)}this.create()},create:function(){var b=this;this.dataModel&&(this.hasDataTable?(this.dataModel.ref(this.field).subscribe(function(a){b.modelValueChange(a)}),this.dataModel.refEnable(this.field).subscribe(function(a){b.setEnable(a)}),this.setEnable(this.dataModel.isEnable(this.field))):this.dataModel.subscribe(function(a){b.modelValueChange(a)}),this.modelValueChange(this.hasDataTable?this.dataModel.getValue(this.field):this.dataModel())),a(this.element).on("click",function(){b.trigger("click",{field:b.field,dataTable:b.dataModel})})},modelValueChange:function(a){this.setValue(a)},parseDataModel:function(){this.options&&this.options.data&&(this.dataModel=a.getJSObject(this.viewModel,this.options.data),this.dataModel instanceof a.DataTable&&(this.hasDataTable=!0,this.field=this.options.field))},setValue:function(b){this.value=b,a(this.element).html(b)},getValue:function(){return this.value},setEnable:function(b){b===!0||"true"===b?(this.enable=!0,a(this.element).removeAttr("readonly")):(b===!1||"false"===b)&&(this.enable=!0,a(this.element).attr("readonly","readonly"))},Statics:{compName:"link"}});a.compManager&&a.compManager.addPlug(b)}($),+function(a){var b=a.InputComp.extend({initialize:function(){var c=this;b.superclass.initialize.apply(this,arguments),this.create(),"TEXTAREA"==this.element.nodeName&&(a(this.element).focusin(function(){c.setShowValue(c.getValue())}),a(this.element).blur(function(){c.setValue(c.element.value)}))},modelValueChange:function(a){this.slice||(a=a||"",this.trueValue=a,this.showValue=a,this.setShowValue(this.showValue))},setValue:function(a){this.trueValue=a,this.showValue=a,this.setShowValue(this.showValue),this.slice=!0,this.setModelValue(this.trueValue),this.slice=!1,this.trigger(b.EVENT_VALUE_CHANGE,this.trueValue)},getValue:function(){return this.trueValue},setShowValue:function(a){this.showValue=a,this.element.value=a},getShowValue:function(){return this.showValue},Statics:{compName:"textarea"}});a.compManager&&a.compManager.addPlug(b)}($),+function($,ko){function _updateDom(a,b){for(var c in b){var d=b[c];for(var e in d){var f=d[e];if("trigger"==e)a.trigger(f[0]);else if($.isArray(f))$.each(f,function(b,c){a[b](c)});else try{a[c](d)}catch(g){a[c](d[c])}}}}var App=function(){this.dataTables={}};App.fn=App.prototype,App.fn.init=function(a,b){var c=this;this.element=b||document.body,$(this.element).find("[u-meta]").each(function(){if(!($(this).data("u-meta")||$(this).parents("[u-meta]").length>0)){var b=JSON.parse($(this).attr("u-meta"));if(b&&b.type){c.adjustFunc&&c.adjustFunc.call(c,b);var d=$.compManager._createComp(this,b,a,c);d&&$(this).data("u-meta",d)}}}),_getDataTables(this,a);try{ko.applyBindings(a,this.element)}catch(d){iweb.log.error(d)}},App.fn.setAdjustMetaFunc=function(a){this.adjustFunc=a},App.fn.addDataTable=function(a){return this.dataTables[a.id]=a,this},App.fn.getDataTable=function(a){return this.dataTables[a]},App.fn.getDataTables=function(){return this.dataTables},App.fn.getComp=function(a){var b=null;return $(this.element).find("[u-meta]").each(function(){if($(this).data("u-meta")){var c=$(this).data("u-meta");if(c.id==a)return b=c,!1}}),b},App.fn.getComps=function(a){a=a?a:this.element;var b=[];return $(a).find("[u-meta]").each(function(){if($(this).data("u-meta")){var a=$(this).data("u-meta");a&&b.push(a)}}),b},App.fn.compsValidate=function(a){for(var b=this.getComps(a),c=!0,d=0;d<b.length;d++)b[d].doValidate&&(c=b[d].doValidate()&&c);return c},App.fn.getCompsByType=function(a,b){b=b?b:this.element;var c=[];return $(b).find("[u-meta]").each(function(){if($(this).data("u-meta")){var b=$(this).data("u-meta");b&&b.type==a&&c.push(b)}}),c},App.fn.getEnvironment=function(){return window.iweb.Core.collectEnvironment()},App.fn.setClientAttribute=function(a,b){window.iweb.Core.setClientAttribute(a,b)},App.fn.getClientAttribute=function(a){window.iweb.Core.getClientAttributes()[a]},App.fn.serverEvent=function(){return new ServerEvent(this)},App.fn.ajax=function(a){a=this._wrapAjax(a),$.ajax(a)},App.fn._wrapAjax=function(a){var b=this,c=a.success,d=a.error,e=a.deferred;return e&&e.resolve||(e={resolve:function(){},reject:function(){}}),a.success=function(a,d,f){processXHRError(b,a,d,f)?(c.call(null,a),b._successFunc(a,e)):e.reject()},a.error=function(a,c,f){processXHRError(b,a,c,f)?(d.call(null,a),b._successFunc(a,e)):e.reject()},a.data?a.data.environment=ko.toJSON(window.iweb.Core.collectEnvironment()):a.data={environment:ko.toJSON(window.iweb.Core.collectEnvironment())},a},App.fn._successFunc=function(a,b){b.resolve()},App.fn.setUserCache=function(a,b){var c=this.getEnvironment().usercode;c&&localStorage.setItem(c+a,b)},App.fn.getUserCache=function(a){var b=this.getEnvironment().usercode;if(b)return localStorage.getItem(b+a)},App.fn.removeUserCache=function(a){var b=this.getEnvironment().usercode;b&&localStorage.removeItem(b+a)},App.fn.setCache=function(a,b){localStorage.setItem(a,b)},App.fn.getCache=function(a){return localStorage.getItem(a)},App.fn.removeCache=function(a){localStorage.removeItem(a)},App.fn.setSessionCache=function(a,b){sessionStorage.setItem(a,b)},App.fn.getSessionCache=function(a){return sessionStorage.getItem(a)},App.fn.removeSessionCache=function(a){sessionStorage.removeItem(a)},App.fn.setEnable=function(a){$(this.element).find("[u-meta]").each(function(){if($(this).data("u-meta")){var b=$(this).data("u-meta");b.setEnable&&b.setEnable(a)}})};var ServerEvent=function(a){this.app=a,this.datas={},this.params={},this.event=null,this.ent=window.iweb.Core.collectEnvironment(),window.pako&&0==iweb.debugMode&&(this.compression=!0)};ServerEvent.DEFAULT={async:!0,singleton:!0,url:(window.$ctx||"/iwebap")+"/evt/dispatch"},ServerEvent.fn=ServerEvent.prototype,ServerEvent.fn.addDataTable=function(a,b){var c=this.app.getDataTable(a);return this.datas[a]=c.getDataByRule(b),this},ServerEvent.fn.setCompression=function(a){window.pako||1!=a?this.compression=a:iweb.log.error("can't compression, please include  pako!")},ServerEvent.fn.addDataTables=function(a){for(var b=0;b<a.length;b++){var c=a[b];if("string"==typeof c)this.addDataTable(c);else for(key in c)this.addDataTable(key,c[key])}return this},ServerEvent.fn.addAllDataTables=function(a){for(var b=this.app.dataTables,c=0;c<b.length;c++)this.addDataTable(b[c].id,a)},ServerEvent.fn.addParameter=function(a,b){return this.params[a]=b,this},ServerEvent.fn.setEvent=function(a){return this.event=a,this};var _formatEvent=function(a){return a};ServerEvent.fn.fire=function(a){var b=this,c=this.getData();c.parameters=ko.toJSON(this.params);var d={type:a.type||"POST",data:a.params||{},url:a.url||ServerEvent.DEFAULT.url,async:"undefined"==typeof a.async?ServerEvent.DEFAULT.async:a.async,singleton:a.singleton||ServerEvent.DEFAULT.singleton,success:a.success,error:a.error,dataType:"json"};d.data.ctrl=a.ctrl,d.data.method=a.method,this.event&&(d.data.event=ko.toJSON(this.event));var e=d.preSuccess||function(){},f=d.success||function(){},g=d.error;this.orignError=g;var h=d.deferred;h&&h.resolve||(h={resolve:function(){},reject:function(){}}),d.success=function(a,c,d){processXHRError(b,a,c,d)?(e.call(null,a),b._successFunc(a,h),f.call(null,a.custom),h.resolve()):h.reject()},d.error=function(a,c,d){processXHRError(b,a,c,d)?g&&g.call(null,a.custom):h.reject()},d.data=$.extend(d.data,c),$.ajax(d)},ServerEvent.fn.getData=function(){var a=ko.toJSON(this.app.getEnvironment()),b=ko.toJSON(this.datas);return this.compression&&(a=encodeBase64(window.pako.gzip(a)),b=encodeBase64(window.pako.gzip(b))),{environment:a,dataTables:b,compression:this.compression}},ServerEvent.fn._successFunc=function(a,b){var c=a.dataTables,d=a.dom;d&&this.updateDom(JSON.parse(d)),c&&this.updateDataTables(c,b)},ServerEvent.fn.updateDataTables=function(a){for(var b in a){var c=this.app.getDataTable(b);c&&c.setData(a[b])}},ServerEvent.fn.setSuccessFunc=function(a){this._successFunc=a},ServerEvent.fn.updateDom=function(){$.each(dom,function(a,b){var c=b.two,d=$(b.one);_updateDom(d,c)})};var processXHRError=function(self,rsl,state,xhr){if("string"==typeof rsl&&(rsl=JSON.parse(rsl)),xhr.getResponseHeader&&xhr.getResponseHeader("X-Error")){if(!self.orignError)return $.showMessageDialog?$.showMessageDialog({type:"info",title:"提示",msg:rsl.message,backdrop:!0}):alert(rsl.message),rsl.operate&&eval(rsl.operate),!1;self.orignError.call(self,rsl,state,xhr)}return!0};$.createApp=function(){var a=new App;return a};var _getDataTables=function(a,b){for(var c in b)b[c]instanceof $.DataTable&&(b[c].id=c,a.addDataTable(b[c]))}}($,ko)});
//# sourceMappingURL=u.min.map